<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…³äºå°èŠ¸çš„ä¸€åˆ‡</title>
    <style>
        /* ===== å…¨å±€æ ·å¼ä¸å¢¨ç»¿è‰²ç³»ä¸»é¢˜ ===== */
        :root {
            --bg-light: #f8f9f5;
            --card-bg: #f0f4eb;
            --primary: #2c5530;
            --primary-dark: #1e3a22;
            --accent: #4a7c59;
            --highlight: #b99346;
            --text-dark: #333333;
            --text-light: #666666;
            --border: #d8e2d4;
            --success: #4a7c59;
            --warning: #d4a017;
            --danger: #c44536;
            --shadow: rgba(44, 85, 48, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            background-image: linear-gradient(135deg, #f8f9f5 0%, #e8f1e0 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px var(--shadow);
            overflow: hidden;
            min-height: 90vh;
        }
        
        /* ===== æ ‡é¢˜åŒºåŸŸ ===== */
        .header {
            background: linear-gradient(to right, var(--primary), var(--accent));
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.2;
        }
        
        .main-title {
            font-size: 2.8rem;
            font-weight: 300;
            letter-spacing: 1px;
            margin-bottom: 8px;
            position: relative;
        }
        
        .subtitle {
            font-size: 1.1rem;
            font-weight: 300;
            opacity: 0.9;
            font-style: italic;
        }
        
        /* ===== å¯¼èˆªé€‰é¡¹å¡ ===== */
        .tabs {
            display: flex;
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border);
        }
        
        .tab {
            flex: 1;
            padding: 18px 0;
            text-align: center;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .tab:hover {
            background-color: rgba(74, 124, 89, 0.05);
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--highlight);
            font-weight: 500;
            background-color: white;
        }
        
        .tab-icon {
            font-size: 1.3rem;
        }
        
        /* ===== ä¸»å†…å®¹åŒºåŸŸ ===== */
        .content {
            padding: 30px;
            min-height: 500px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== é€šç”¨å¡ç‰‡æ ·å¼ ===== */
        .dashboard-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px var(--shadow);
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 25px;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--shadow);
        }
        
        .card-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 12px;
        }
        
        .card-icon {
            font-size: 1.4rem;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        /* ===== æŒ‰é’®æ ·å¼ ===== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        .btn-primary {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary);
        }
        
        .btn-secondary {
            background-color: var(--card-bg);
            color: var(--text-dark);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background-color: #e8efe0;
        }
        
        .btn-edit {
            background-color: var(--highlight);
            color: white;
        }
        
        .btn-edit:hover {
            background-color: #a87d3a;
        }
        
        .btn-delete {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .btn-delete:hover {
            background-color: #f1b0b7;
        }
        
        .btn-save {
            background-color: var(--success);
            color: white;
        }
        
        .btn-save:hover {
            background-color: #3a6b48;
        }
        
        .btn-cancel {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-cancel:hover {
            background-color: #545b62;
        }
        
        /* ===== è¡¨å•æ ·å¼ ===== */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            transition: border 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        /* ===== ç¼–è¾‘æ¨¡æ€æ¡† ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.4rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background-color: var(--card-bg);
            color: var(--primary);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* ===== Dashboard ä»ªè¡¨ç›˜ ===== */
        .dashboard-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .total-assets {
            font-size: 2.2rem;
            font-weight: 300;
            color: var(--primary);
            margin: 15px 0;
            text-align: center;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .quick-btn {
            padding: 14px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .quick-btn:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .btn-icon {
            font-size: 1.2rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent);
        }
        
        .status-item .status-text {
            flex: 1;
        }
        
        /* ===== å­¦ä¹ ä¸­å¿ƒæ ·å¼ ===== */
        .todo-list, .wishlist-items, .exercise-list, .medication-list, .journal-list, .account-list {
            margin-top: 20px;
        }
        
        .todo-item, .wishlist-item, .exercise-item, .medication-item, .journal-item, .account-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid var(--accent);
            transition: all 0.2s ease;
        }
        
        .todo-item:hover, .wishlist-item:hover, .exercise-item:hover, 
        .medication-item:hover, .journal-item:hover, .account-item:hover {
            background-color: #e8efe0;
            transform: translateX(5px);
        }
        
        .item-checkbox {
            width: 22px;
            height: 22px;
            margin-right: 15px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .item-content {
            flex: 1;
            min-width: 0;
        }
        
        .item-title {
            font-weight: 500;
            margin-bottom: 5px;
            word-break: break-word;
        }
        
        .item-subtitle {
            font-size: 0.9rem;
            color: var(--text-light);
            word-break: break-word;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            margin-left: 10px;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--success);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .timer-section {
            background-color: var(--primary);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-top: 30px;
        }
        
        .timer-display {
            font-size: 3rem;
            font-family: monospace;
            margin: 20px 0;
            letter-spacing: 2px;
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .timer-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 100px;
        }
        
        /* ===== æ—¥è®°æ¨¡å—æ ·å¼ ===== */
        .journal-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .journal-editor {
            flex: 2;
            min-width: 300px;
        }
        
        .journal-sidebar {
            flex: 1;
            min-width: 250px;
        }
        
        .journal-textarea {
            width: 100%;
            height: 300px;
            padding: 20px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            margin-bottom: 20px;
            background-color: var(--card-bg);
        }
        
        .emotion-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .emotion-btn {
            padding: 10px 20px;
            border: 1px solid var(--border);
            background-color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .emotion-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px var(--shadow);
        }
        
        .emotion-btn.selected {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .notebook-list {
            margin-top: 15px;
        }
        
        .notebook-item {
            padding: 12px 15px;
            border-left: 3px solid var(--border);
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notebook-item:hover {
            background-color: var(--card-bg);
            border-left-color: var(--accent);
        }
        
        .notebook-item.active {
            background-color: var(--card-bg);
            border-left-color: var(--highlight);
            font-weight: 500;
        }
        
        /* ===== è´¢äº§æ¨¡å—æ ·å¼ ===== */
        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .account-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px var(--shadow);
            border-top: 4px solid var(--accent);
            transition: all 0.3s ease;
        }
        
        .account-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--shadow);
        }
        
        .account-name {
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .account-balance {
            font-size: 1.8rem;
            font-weight: 300;
            color: var(--primary);
        }
        
        .transaction-form {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px var(--shadow);
            margin-bottom: 30px;
        }
        
        .wishlist-item, .transaction-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 3px 8px var(--shadow);
        }
        
        /* ===== å¥åº·æ¨¡å—æ ·å¼ ===== */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .mood-calendar {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px var(--shadow);
            margin-top: 25px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar-day.empty {
            background-color: transparent;
            cursor: default;
        }
        
        .calendar-day.good {
            background-color: rgba(74, 124, 89, 0.2);
            color: var(--primary);
        }
        
        .calendar-day.neutral {
            background-color: rgba(185, 147, 70, 0.2);
            color: var(--highlight);
        }
        
        .calendar-day.bad {
            background-color: rgba(196, 69, 54, 0.2);
            color: var(--danger);
        }
        
        .calendar-day:hover:not(.empty) {
            transform: scale(1.1);
            box-shadow: 0 5px 10px var(--shadow);
        }
        
        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 768px) {
            .container {
                border-radius: 12px;
            }
            
            .header {
                padding: 20px;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 50%;
                padding: 15px 0;
            }
            
            .content {
                padding: 20px;
            }
            
            .dashboard-section {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .journal-container {
                flex-direction: column;
            }
            
            .health-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px;
            }
        }
        
        /* ===== å·¥å…·ç±» ===== */
        .text-center {
            text-align: center;
        }
        
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .mb-10 { margin-bottom: 10px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        
        .d-flex {
            display: flex;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .align-center {
            align-items: center;
        }
        
        .flex-wrap {
            flex-wrap: wrap;
        }
        
        .gap-10 {
            gap: 10px;
        }
        
        .gap-20 {
            gap: 20px;
        }
        
        .w-100 {
            width: 100%;
        }
        
        .hidden {
            display: none !important;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="header">
            <h1 class="main-title">å…³äºå°èŠ¸çš„ä¸€åˆ‡</h1>
            <p class="subtitle">åŸæ¥ä½ ä¸€ç›´åœ¨è¿™é‡Œã€‚</p>
        </div>
        
        <!-- å¯¼èˆªé€‰é¡¹å¡ -->
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">
                <span class="tab-icon">ğŸ“Š</span>
                <span>ä»ªè¡¨ç›˜</span>
            </div>
            <div class="tab" data-tab="study">
                <span class="tab-icon">ğŸ“–</span>
                <span>å­¦ä¹ ä¸­å¿ƒ</span>
            </div>
            <div class="tab" data-tab="journal">
                <span class="tab-icon">ğŸ““</span>
                <span>æ—¥è®°</span>
            </div>
            <div class="tab" data-tab="finance">
                <span class="tab-icon">ğŸ’°</span>
                <span>è´¢äº§ç®¡ç†</span>
            </div>
            <div class="tab" data-tab="health">
                <span class="tab-icon">ğŸŒ¿</span>
                <span>å¥åº·ç®¡ç†</span>
            </div>
            <div class="tab" data-tab="settings">
                <span class="tab-icon">âš™ï¸</span>
                <span>ç³»ç»Ÿè®¾ç½®</span>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="content">
            <!-- ä»ªè¡¨ç›˜ -->
            <div class="tab-content active" id="dashboard">
                <div class="dashboard-section">
                    <!-- æ€»èµ„äº§å¡ç‰‡ -->
                    <div class="dashboard-card">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ’°</span>
                            æ€»èµ„äº§æ¦‚è§ˆ
                            <button class="btn btn-edit btn-sm" onclick="editTotalAssets()">ç¼–è¾‘</button>
                        </h3>
                        <div class="total-assets" id="totalAssetsDisplay">Â¥ 0.00</div>
                        <div class="text-center">
                            <button class="btn btn-secondary" onclick="switchTab('finance')">æŸ¥çœ‹è¯¦æƒ…</button>
                        </div>
                    </div>
                    
                    <!-- å¿«æ·æ“ä½œå¡ç‰‡ -->
                    <div class="dashboard-card">
                        <h3 class="card-title">
                            <span class="card-icon">âš¡</span>
                            å¿«æ·æ“ä½œ
                            <button class="btn btn-edit btn-sm" onclick="editQuickActions()">ç¼–è¾‘</button>
                        </h3>
                        <div class="quick-actions" id="quickActionsContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- ä»Šæ—¥çŠ¶æ€å¡ç‰‡ -->
                    <div class="dashboard-card">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ“Š</span>
                            ä»Šæ—¥çŠ¶æ€
                            <button class="btn btn-edit btn-sm" onclick="editTodayStatus()">ç¼–è¾‘</button>
                        </h3>
                        <div id="todayStatusContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <!-- æ¨¡å—è”åŠ¨æç¤º -->
                <div class="dashboard-card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ”—</span>
                        æ¨¡å—è”åŠ¨
                    </h3>
                    <div class="status-item">
                        <div class="status-text">
                            <strong>å­¦ä¹ è®¡æ—¶ â†’ æ—¥è®°</strong>
                            <div>è®¡æ—¶ç»“æŸåå¯å¿«é€Ÿè®°å½•å­¦ä¹ å¿ƒå¾—</div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-text">
                            <strong>æƒ…ç»ªæ ‡è®° â†’ å¥åº·æ—¥å†</strong>
                            <div>æ—¥è®°ä¸­çš„æƒ…ç»ªè‡ªåŠ¨åŒæ­¥åˆ°å¥åº·æ¨¡å—</div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-text">
                            <strong>è¿åŠ¨ç›®æ ‡ â†’ è´¢äº§å¿ƒæ„¿</strong>
                            <div>è¿åŠ¨è¾¾æ ‡å¯è®¾ç½®è´¢äº§å¿ƒæ„¿å•å¥–åŠ±</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å­¦ä¹ ä¸­å¿ƒ -->
            <div class="tab-content" id="study">
                <div class="dashboard-card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ“–</span>
                        å­¦ä¹ ä¸­å¿ƒ
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="showTodoModal()">+ æ·»åŠ å¾…åŠ</button>
                            <button class="btn btn-secondary" onclick="showSkillModal()">+ æ·»åŠ æŠ€èƒ½</button>
                        </div>
                    </h3>
                    
                    <!-- å¾…åŠäº‹é¡¹ -->
                    <div class="form-group">
                        <label>ä»Šæ—¥å¾…åŠäº‹é¡¹</label>
                        <div class="todo-list" id="todoListContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- å­¦ä¹ è®¡æ—¶å™¨ -->
                    <div class="timer-section">
                        <h3 style="color: white; margin-bottom: 20px;">ä¸“æ³¨è®¡æ—¶å™¨</h3>
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <div class="timer-controls">
                            <button class="timer-btn start" onclick="startTimer()">å¼€å§‹</button>
                            <button class="timer-btn pause" onclick="pauseTimer()">æš‚åœ</button>
                            <button class="timer-btn stop" onclick="stopTimer()">ç»“æŸ</button>
                            <button class="timer-btn" style="background-color: var(--highlight);" onclick="editTimerSettings()">è®¾ç½®</button>
                        </div>
                        <div class="mt-20">
                            <input type="text" class="form-control" id="timerNote" placeholder="è¾“å…¥å­¦ä¹ å†…å®¹å¤‡æ³¨...">
                        </div>
                    </div>
                    
                    <!-- æƒ³å­¦æŠ€èƒ½ -->
                    <div class="mt-30">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ¯</span>
                            æƒ³å­¦æŠ€èƒ½
                        </h3>
                        <div class="todo-list" id="skillListContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ—¥è®°æ¨¡å— -->
            <div class="tab-content" id="journal">
                <div class="dashboard-card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ““</span>
                        æ—¥è®°æœ¬ç®¡ç†
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="showNotebookModal()">+ æ–°å»ºæ—¥è®°æœ¬</button>
                        </div>
                    </h3>
                    
                    <div class="journal-container">
                        <!-- æ—¥è®°æœ¬åˆ—è¡¨ -->
                        <div class="journal-sidebar">
                            <div class="notebook-list" id="notebookListContainer">
                                <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <!-- æ—¥è®°ç¼–è¾‘å™¨ -->
                        <div class="journal-editor">
                            <div class="form-group">
                                <label>å†™æ—¥è®°</label>
                                <input type="text" class="form-control mb-10" placeholder="æ—¥è®°æ ‡é¢˜" id="journalTitle">
                                <textarea class="journal-textarea" placeholder="è®°å½•ä»Šå¤©çš„ç‚¹ç‚¹æ»´æ»´...ï¼ˆè¾“å…¥ //now æ’å…¥å½“å‰æ—¶é—´ï¼‰" id="journalContent"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>é€‰æ‹©æƒ…ç»ª</label>
                                <div class="emotion-selector" id="emotionSelector">
                                    <div class="emotion-btn" onclick="selectEmotion(this, 'good')">ğŸ˜Š å¼€å¿ƒ</div>
                                    <div class="emotion-btn" onclick="selectEmotion(this, 'good')">ğŸ˜Œ å¹³é™</div>
                                    <div class="emotion-btn" onclick="selectEmotion(this, 'neutral')">ğŸ˜ ä¸€èˆ¬</div>
                                    <div class="emotion-btn" onclick="selectEmotion(this, 'bad')">ğŸ˜” éš¾è¿‡</div>
                                    <div class="emotion-btn" onclick="selectEmotion(this, 'bad')">ğŸ˜« ç–²æƒ«</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>é€‰æ‹©æ—¥è®°æœ¬</label>
                                <select class="form-control" id="journalNotebookSelect">
                                    <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </select>
                            </div>
                            
                            <div class="d-flex justify-between mt-20">
                                <button class="btn btn-secondary" onclick="insertTimestamp()">æ’å…¥å½“å‰æ—¶é—´</button>
                                <button class="btn btn-primary" onclick="saveJournal()">ä¿å­˜æ—¥è®°</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ—¥è®°åˆ—è¡¨ -->
                    <div class="mt-30">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ“„</span>
                            æœ€è¿‘æ—¥è®°
                            <button class="btn btn-secondary btn-sm" onclick="refreshJournals()">åˆ·æ–°</button>
                        </h3>
                        <div class="journal-list" id="journalListContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è´¢äº§ç®¡ç† -->
            <div class="tab-content" id="finance">
                <div class="dashboard-card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸ’°</span>
                        è´¢äº§ç®¡ç†
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="showAccountModal()">+ æ·»åŠ è´¦æˆ·</button>
                            <button class="btn btn-secondary" onclick="showWishModal()">+ æ·»åŠ å¿ƒæ„¿</button>
                        </div>
                    </h3>
                    
                    <!-- è´¦æˆ·æ¦‚è§ˆ -->
                    <div class="form-group">
                        <label>è´¦æˆ·æ¦‚è§ˆ</label>
                        <div class="accounts-grid" id="accountsGridContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- å¿«é€Ÿè®°è´¦ -->
                    <div class="transaction-form">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ’¸</span>
                            å¿«é€Ÿè®°è´¦
                        </h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ç±»å‹</label>
                                <select class="form-control" id="transactionType">
                                    <option value="expense">æ”¯å‡º</option>
                                    <option value="income">æ”¶å…¥</option>
                                    <option value="transfer">è½¬è´¦</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>åˆ†ç±»</label>
                                <select class="form-control" id="transactionCategory">
                                    <option value="food">é¤é¥®</option>
                                    <option value="transport">äº¤é€š</option>
                                    <option value="shopping">è´­ç‰©</option>
                                    <option value="study">å­¦ä¹ </option>
                                    <option value="entertainment">å¨±ä¹</option>
                                    <option value="salary">å·¥èµ„</option>
                                    <option value="other">å…¶ä»–</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>é‡‘é¢ (Â¥)</label>
                                <input type="number" class="form-control" id="transactionAmount" placeholder="0.00" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>è´¦æˆ·</label>
                                <select class="form-control" id="transactionAccount">
                                    <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>æ—¥æœŸ</label>
                                <input type="date" class="form-control" id="transactionDate">
                            </div>
                            <div class="form-group">
                                <label>å¤‡æ³¨ (å¯é€‰)</label>
                                <input type="text" class="form-control" id="transactionNote" placeholder="ä¾‹å¦‚ï¼šåˆé¤">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ç›®æ ‡è´¦æˆ· (ä»…è½¬è´¦æ—¶ä½¿ç”¨)</label>
                            <select class="form-control" id="transactionTargetAccount">
                                <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </select>
                        </div>
                        <button class="btn btn-primary w-100" onclick="addTransaction()">è®°å½•è¿™ç¬”è´¦</button>
                    </div>
                    
                    <!-- äº¤æ˜“è®°å½• -->
                    <div class="mt-30">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ“‹</span>
                            æœ€è¿‘äº¤æ˜“è®°å½•
                            <button class="btn btn-secondary btn-sm" onclick="refreshTransactions()">åˆ·æ–°</button>
                        </h3>
                        <div class="todo-list" id="transactionListContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- å¿ƒæ„¿å• -->
                    <div class="mt-30">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ</span>
                            å¿ƒæ„¿å•
                        </h3>
                        <div class="todo-list" id="wishlistContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        <div class="mt-20 d-flex justify-between align-center">
                            <div>
                                <strong>é€‰ä¸­çš„ç›®æ ‡æ€»éœ€ï¼š<span id="wishlistTotal">Â¥ 0</span></strong>
                            </div>
                            <button class="btn btn-primary" onclick="showWishModal()">+ æ·»åŠ æ–°æ„¿æœ›</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å¥åº·ç®¡ç† -->
            <div class="tab-content" id="health">
                <div class="dashboard-card">
                    <h3 class="card-title">
                        <span class="card-icon">ğŸŒ¿</span>
                        å¥åº·ç®¡ç†
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="showMedicationModal()">+ æ·»åŠ è¯å“</button>
                            <button class="btn btn-secondary" onclick="showExerciseModal()">+ æ·»åŠ è¿åŠ¨</button>
                        </div>
                    </h3>
                    
                    <div class="health-grid">
                        <!-- æœè¯ç®¡ç† -->
                        <div class="medication-list">
                            <h3 class="card-title">
                                <span class="card-icon">ğŸ’Š</span>
                                ä»Šæ—¥æœè¯
                            </h3>
                            <div class="todo-list" id="medicationListContainer">
                                <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <div class="mt-20 d-flex justify-between">
                                <button class="btn btn-secondary" onclick="markAllMedications()">æ ‡è®°å…¨éƒ¨å®Œæˆ</button>
                                <button class="btn btn-primary" onclick="showMedicationModal()">+ æ·»åŠ æ–°è¯</button>
                            </div>
                        </div>
                        
                        <!-- è¿åŠ¨è®¡åˆ’ -->
                        <div class="exercise-planner">
                            <h3 class="card-title">
                                <span class="card-icon">ğŸƒ</span>
                                ä»Šæ—¥è¿åŠ¨
                            </h3>
                            <div class="todo-list" id="exerciseListContainer">
                                <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <div class="mt-20">
                                <button class="btn btn-primary w-100" onclick="showExerciseModal()">+ è°ƒæ•´è¿åŠ¨ä»»åŠ¡</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æƒ…ç»ªæ—¥å† -->
                    <div class="mood-calendar mt-30">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ“…</span>
                            æƒ…ç»ªæ—¥å† - <span id="currentMonthDisplay"></span>
                            <div class="card-actions">
                                <button class="btn btn-secondary btn-sm" onclick="prevMonth()">ä¸Šä¸ªæœˆ</button>
                                <button class="btn btn-secondary btn-sm" onclick="nextMonth()">ä¸‹ä¸ªæœˆ</button>
                            </div>
                        </h3>
                        <div class="calendar-grid" id="calendarGridContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        
                        <div class="mt-20 d-flex justify-center flex-wrap gap-20">
                            <div class="d-flex align-center">
                                <div class="calendar-day good" style="width: 20px; height: 20px; margin-right: 8px;"></div>
                                <span>å¥½</span>
                            </div>
                            <div class="d-flex align-center">
                                <div class="calendar-day neutral" style="width: 20px; height: 20px; margin-right: 8px;"></div>
                                <span>ä¸€èˆ¬</span>
                            </div>
                            <div class="d-flex align-center">
                                <div class="calendar-day bad" style="width: 20px; height: 20px; margin-right: 8px;"></div>
                                <span>å·®</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- èº«ä½“æ•°æ®è®°å½• -->
                    <div class="mt-30">
                        <h3 class="card-title">
                            <span class="card-icon">ğŸ“ˆ</span>
                            èº«ä½“æ•°æ®è®°å½•
                            <button class="btn btn-primary btn-sm" onclick="showBodyDataModal()">+ æ·»åŠ è®°å½•</button>
                        </h3>
                        <div class="todo-list" id="bodyDataListContainer">
                            <!-- é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div class="tab-content" id="settings">
                <div class="dashboard-card">
                    <h3 class="card-title">
                        <span class="card-icon">âš™ï¸</span>
                        ç³»ç»Ÿè®¾ç½®
                    </h3>
                    
                    <div class="form-group">
                        <label>æ•°æ®ç®¡ç†</label>
                        <div class="d-flex gap-10 flex-wrap">
                            <button class="btn btn-primary" onclick="exportData()">å¯¼å‡ºæ‰€æœ‰æ•°æ®</button>
                            <button class="btn btn-secondary" onclick="importData()">å¯¼å…¥æ•°æ®</button>
                            <button class="btn btn-secondary" onclick="backupData()">å¤‡ä»½æ•°æ®</button>
                            <button class="btn btn-delete" onclick="resetData()">é‡ç½®æ‰€æœ‰æ•°æ®</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ä¸»é¢˜è®¾ç½®</label>
                        <div class="d-flex gap-10 flex-wrap">
                            <button class="btn btn-secondary" onclick="setTheme('light')">æµ…è‰²ä¸»é¢˜</button>
                            <button class="btn btn-secondary" onclick="setTheme('dark')">æ·±è‰²ä¸»é¢˜</button>
                            <button class="btn btn-secondary" onclick="setTheme('green')">å¢¨ç»¿ä¸»é¢˜</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>åˆå§‹åŒ–ç³»ç»Ÿ</label>
                        <div class="d-flex gap-10 flex-wrap">
                            <button class="btn btn-primary" onclick="initializeSystem()">åˆå§‹åŒ–æ‰€æœ‰æ•°æ®</button>
                            <button class="btn btn-secondary" onclick="initializeModule('study')">åˆå§‹åŒ–å­¦ä¹ ä¸­å¿ƒ</button>
                            <button class="btn btn-secondary" onclick="initializeModule('journal')">åˆå§‹åŒ–æ—¥è®°æ¨¡å—</button>
                            <button class="btn btn-secondary" onclick="initializeModule('finance')">åˆå§‹åŒ–è´¢äº§ç®¡ç†</button>
                            <button class="btn btn-secondary" onclick="initializeModule('health')">åˆå§‹åŒ–å¥åº·ç®¡ç†</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>å¿«æ·é”®è®¾ç½®</label>
                        <div class="status-item">
                            <div class="status-text">
                                <strong>æ’å…¥å½“å‰æ—¶é—´</strong>
                                <div>åœ¨æ—¥è®°ä¸­è¾“å…¥ //now æˆ–æŒ‰ Ctrl+D</div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-text">
                                <strong>å¿«é€Ÿè®°è´¦</strong>
                                <div>åœ¨ä»»æ„é¡µé¢æŒ‰ Ctrl+Q</div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-text">
                                <strong>å¼€å§‹è®¡æ—¶</strong>
                                <div>æŒ‰ Ctrl+T å¼€å§‹å­¦ä¹ è®¡æ—¶</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ç³»ç»Ÿä¿¡æ¯</label>
                        <div class="status-item">
                            <div class="status-text">
                                <strong>ç‰ˆæœ¬</strong>
                                <div>v1.0.0 - å…³äºå°èŠ¸çš„ä¸€åˆ‡</div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-text">
                                <strong>æ•°æ®å­˜å‚¨</strong>
                                <div id="storageInfo">æ­£åœ¨è®¡ç®—...</div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-text">
                                <strong>æœ€åå¤‡ä»½</strong>
                                <div id="lastBackupInfo">ä»æœªå¤‡ä»½</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- é€šç”¨ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">
                    <span id="modalIcon">ğŸ“</span>
                    <span id="modalAction">ç¼–è¾‘</span>
                </h3>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- åŠ¨æ€ç”Ÿæˆè¡¨å• -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <!-- åŠ¨æ€ç”ŸæˆæŒ‰é’® -->
            </div>
        </div>
    </div>
    
    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>âš ï¸</span>
                    ç¡®è®¤æ“ä½œ
                </h3>
                <button class="modal-close" onclick="closeConfirmModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">æ‚¨ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeConfirmModal()">å–æ¶ˆ</button>
                <button class="btn btn-delete" id="confirmActionBtn">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <script>
        // ===== å…¨å±€å˜é‡ =====
        let appData = {
            dashboard: {
                totalAssets: 0,
                quickActions: [
                    { id: 1, name: "å†™æ—¥è®°", icon: "âœï¸", action: "journal" },
                    { id: 2, name: "å¿«é€Ÿè®°è´¦", icon: "ğŸ’°", action: "finance" },
                    { id: 3, name: "å¼€å§‹è®¡æ—¶", icon: "â±ï¸", action: "timer" },
                    { id: 4, name: "åƒè¯æ‰“å¡", icon: "ğŸ’Š", action: "health" }
                ],
                todayStatus: [
                    { id: 1, title: "å­¦ä¹ è¿›åº¦", value: "ä»Šæ—¥å·²å­¦ 0 å°æ—¶ | å¾…åŠ 0 é¡¹" },
                    { id: 2, title: "å¥åº·çŠ¶æ€", value: "ç¡çœ  -- | å–æ°´ --/8 æ¯" },
                    { id: 3, title: "æ—¥è®°è®°å½•", value: "æœ¬æœˆå·²å†™ 0 ç¯‡" },
                    { id: 4, title: "ä»Šæ—¥æƒ…ç»ª", value: "ğŸ˜ æœªè®°å½•" }
                ]
            },
            study: {
                todos: [],
                skills: [],
                timerSettings: {
                    defaultDuration: 25,
                    autoStart: false
                },
                studyRecords: []
            },
            journal: {
                notebooks: [
                    { id: 1, name: "æ—¥å¸¸éšç¬”", color: "#4a7c59", count: 0 }
                ],
                entries: [],
                currentNotebookId: 1
            },
            finance: {
                accounts: [
                    { id: 1, name: "å¾®ä¿¡é’±åŒ…", balance: 356.80, icon: "ğŸ’³", type: "digital" },
                    { id: 2, name: "æ”¯ä»˜å®", balance: 1250.50, icon: "ğŸ’³", type: "digital" },
                    { id: 3, name: "ç°é‡‘", balance: 200.00, icon: "ğŸ’µ", type: "cash" },
                    { id: 4, name: "å‚¨è“„å¡", balance: 5000.00, icon: "ğŸ¦", type: "bank" }
                ],
                transactions: [],
                wishes: [
                    { id: 1, name: "Switchæ¸¸æˆå¡å¸¦", targetAmount: 320, savedAmount: 120, active: true },
                    { id: 2, name: "æ–°çƒé‹", targetAmount: 600, savedAmount: 300, active: true },
                    { id: 3, name: "ç”Ÿæ—¥è¯·å®¢", targetAmount: 500, savedAmount: 0, active: true }
                ],
                categories: ["é¤é¥®", "äº¤é€š", "è´­ç‰©", "å­¦ä¹ ", "å¨±ä¹", "å·¥èµ„", "å…¶ä»–"]
            },
            health: {
                medications: [
                    { id: 1, name: "é˜¿è«è¥¿æ—", dosage: "1ç²’", time: "08:30", taken: false, frequency: "æ¯æ—¥ä¸‰æ¬¡" },
                    { id: 2, name: "ç»´ç”Ÿç´ C", dosage: "1ç²’", time: "12:30", taken: false, frequency: "æ¯æ—¥ä¸€æ¬¡" },
                    { id: 3, name: "è¿‡æ•è¯", dosage: "1ç²’", time: "18:30", taken: false, frequency: "æ¯æ—¥ä¸€æ¬¡" }
                ],
                exercises: [
                    { id: 1, name: "ä¿¯å§æ’‘", target: "3ç»„Ã—15ä¸ª", completed: 0, type: "strength" },
                    { id: 2, name: "æ·±è¹²", target: "3ç»„Ã—20ä¸ª", completed: 0, type: "strength" },
                    { id: 3, name: "æ…¢è·‘", target: "30åˆ†é’Ÿ", completed: 0, type: "cardio" },
                    { id: 4, name: "æ‹‰ä¼¸", target: "10åˆ†é’Ÿ", completed: 0, type: "flexibility" }
                ],
                bodyData: [],
                moodRecords: {},
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear()
            },
            settings: {
                theme: "green",
                shortcuts: {
                    insertTime: "Ctrl+D",
                    quickRecord: "Ctrl+Q",
                    startTimer: "Ctrl+T"
                },
                lastBackup: null,
                version: "1.0.0"
            }
        };
        
        let currentEditItem = null;
        let currentEditType = null;
        let timerInterval = null;
        let timerSeconds = 25 * 60;
        let isTimerRunning = false;
        let selectedEmotion = null;
        let pendingConfirmAction = null;
        
        // ===== åˆå§‹åŒ–ç³»ç»Ÿ =====
        function initializeSystem() {
            // æ¸…ç©ºæ‰€æœ‰æ•°æ®
            appData = {
                dashboard: {
                    totalAssets: 0,
                    quickActions: [
                        { id: 1, name: "å†™æ—¥è®°", icon: "âœï¸", action: "journal" },
                        { id: 2, name: "å¿«é€Ÿè®°è´¦", icon: "ğŸ’°", action: "finance" },
                        { id: 3, name: "å¼€å§‹è®¡æ—¶", icon: "â±ï¸", action: "timer" },
                        { id: 4, name: "åƒè¯æ‰“å¡", icon: "ğŸ’Š", action: "health" }
                    ],
                    todayStatus: [
                        { id: 1, title: "å­¦ä¹ è¿›åº¦", value: "ä»Šæ—¥å·²å­¦ 0 å°æ—¶ | å¾…åŠ 0 é¡¹" },
                        { id: 2, title: "å¥åº·çŠ¶æ€", value: "ç¡çœ  -- | å–æ°´ --/8 æ¯" },
                        { id: 3, title: "æ—¥è®°è®°å½•", value: "æœ¬æœˆå·²å†™ 0 ç¯‡" },
                        { id: 4, title: "ä»Šæ—¥æƒ…ç»ª", value: "ğŸ˜ æœªè®°å½•" }
                    ]
                },
                study: {
                    todos: [],
                    skills: [],
                    timerSettings: {
                        defaultDuration: 25,
                        autoStart: false
                    },
                    studyRecords: []
                },
                journal: {
                    notebooks: [
                        { id: 1, name: "æ—¥å¸¸éšç¬”", color: "#4a7c59", count: 0 }
                    ],
                    entries: [],
                    currentNotebookId: 1
                },
                finance: {
                    accounts: [],
                    transactions: [],
                    wishes: [],
                    categories: ["é¤é¥®", "äº¤é€š", "è´­ç‰©", "å­¦ä¹ ", "å¨±ä¹", "å·¥èµ„", "å…¶ä»–"]
                },
                health: {
                    medications: [],
                    exercises: [],
                    bodyData: [],
                    moodRecords: {},
                    currentMonth: new Date().getMonth(),
                    currentYear: new Date().getFullYear()
                },
                settings: {
                    theme: "green",
                    shortcuts: {
                        insertTime: "Ctrl+D",
                        quickRecord: "Ctrl+Q",
                        startTimer: "Ctrl+T"
                    },
                    lastBackup: null,
                    version: "1.0.0"
                }
            };
            
            // ä¿å­˜åˆ°localStorage
            saveData();
            
            // é‡æ–°æ¸²æŸ“æ‰€æœ‰ç•Œé¢
            renderAll();
            
            alert("ç³»ç»Ÿå·²åˆå§‹åŒ–å®Œæˆï¼");
        }
        
        function initializeModule(module) {
            switch(module) {
                case 'study':
                    appData.study = {
                        todos: [],
                        skills: [],
                        timerSettings: {
                            defaultDuration: 25,
                            autoStart: false
                        },
                        studyRecords: []
                    };
                    renderStudyModule();
                    alert("å­¦ä¹ ä¸­å¿ƒå·²åˆå§‹åŒ–ï¼");
                    break;
                    
                case 'journal':
                    appData.journal = {
                        notebooks: [
                            { id: 1, name: "æ—¥å¸¸éšç¬”", color: "#4a7c59", count: 0 }
                        ],
                        entries: [],
                        currentNotebookId: 1
                    };
                    renderJournalModule();
                    alert("æ—¥è®°æ¨¡å—å·²åˆå§‹åŒ–ï¼");
                    break;
                    
                case 'finance':
                    appData.finance = {
                        accounts: [],
                        transactions: [],
                        wishes: [],
                        categories: ["é¤é¥®", "äº¤é€š", "è´­ç‰©", "å­¦ä¹ ", "å¨±ä¹", "å·¥èµ„", "å…¶ä»–"]
                    };
                    renderFinanceModule();
                    alert("è´¢äº§ç®¡ç†å·²åˆå§‹åŒ–ï¼");
                    break;
                    
                case 'health':
                    appData.health = {
                        medications: [],
                        exercises: [],
                        bodyData: [],
                        moodRecords: {},
                        currentMonth: new Date().getMonth(),
                        currentYear: new Date().getFullYear()
                    };
                    renderHealthModule();
                    alert("å¥åº·ç®¡ç†å·²åˆå§‹åŒ–ï¼");
                    break;
            }
            
            saveData();
        }
        
        // ===== æ•°æ®å­˜å‚¨ =====
        function saveData() {
            localStorage.setItem('xiaoyunSystemData', JSON.stringify(appData));
            updateStorageInfo();
        }
        
        function loadData() {
            const saved = localStorage.getItem('xiaoyunSystemData');
            if (saved) {
                appData = JSON.parse(saved);
                // ç¡®ä¿æ‰€æœ‰å¿…è¦å­—æ®µéƒ½å­˜åœ¨
                if (!appData.dashboard) initializeSystem();
            }
            updateStorageInfo();
        }
        
        function updateStorageInfo() {
            const dataStr = JSON.stringify(appData);
            const size = new Blob([dataStr]).size;
            const kb = (size / 1024).toFixed(2);
            document.getElementById('storageInfo').textContent = `${kb} KB å·²ä½¿ç”¨`;
            
            if (appData.settings.lastBackup) {
                const date = new Date(appData.settings.lastBackup);
                document.getElementById('lastBackupInfo').textContent = date.toLocaleString();
            }
        }
        
        // ===== æ¸²æŸ“å‡½æ•° =====
        function renderAll() {
            renderDashboard();
            renderStudyModule();
            renderJournalModule();
            renderFinanceModule();
            renderHealthModule();
            renderSettingsModule();
        }
        
        function renderDashboard() {
            // æ›´æ–°æ€»èµ„äº§
            const total = appData.finance.accounts.reduce((sum, acc) => sum + acc.balance, 0);
            appData.dashboard.totalAssets = total;
            document.getElementById('totalAssetsDisplay').textContent = `Â¥ ${total.toFixed(2)}`;
            
            // æ¸²æŸ“å¿«æ·æ“ä½œ
            const quickActionsContainer = document.getElementById('quickActionsContainer');
            quickActionsContainer.innerHTML = '';
            appData.dashboard.quickActions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'quick-btn';
                button.innerHTML = `<span class="btn-icon">${action.icon}</span> ${action.name}`;
                button.onclick = () => quickAction(action.action);
                quickActionsContainer.appendChild(button);
            });
            
            // æ¸²æŸ“ä»Šæ—¥çŠ¶æ€
            const statusContainer = document.getElementById('todayStatusContainer');
            statusContainer.innerHTML = '';
            appData.dashboard.todayStatus.forEach(status => {
                const div = document.createElement('div');
                div.className = 'status-item';
                div.innerHTML = `
                    <div class="status-text">
                        <strong>${status.title}</strong>
                        <div>${status.value}</div>
                    </div>
                    <button class="btn btn-edit btn-sm" onclick="editStatusItem(${status.id})">ç¼–è¾‘</button>
                `;
                statusContainer.appendChild(div);
            });
            
            saveData();
        }
        
        function renderStudyModule() {
            // æ¸²æŸ“å¾…åŠäº‹é¡¹
            const todoContainer = document.getElementById('todoListContainer');
            todoContainer.innerHTML = '';
            
            if (appData.study.todos.length === 0) {
                todoContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <p>æš‚æ— å¾…åŠäº‹é¡¹</p>
                        <button class="btn btn-primary mt-10" onclick="showTodoModal()">æ·»åŠ ç¬¬ä¸€ä¸ªå¾…åŠ</button>
                    </div>
                `;
            } else {
                appData.study.todos.forEach(todo => {
                    const progress = todo.subtasks && todo.subtasks.length > 0 
                        ? (todo.subtasks.filter(st => st.completed).length / todo.subtasks.length * 100).toFixed(0)
                        : todo.completed ? 100 : 0;
                    
                    const div = document.createElement('div');
                    div.className = 'todo-item';
                    div.innerHTML = `
                        <input type="checkbox" class="item-checkbox" ${todo.completed ? 'checked' : ''} 
                               onclick="toggleTodo(${todo.id})">
                        <div class="item-content">
                            <div class="item-title">${todo.title}</div>
                            ${todo.dueDate ? `<div class="item-subtitle">æˆªæ­¢ï¼š${todo.dueDate}</div>` : ''}
                            ${todo.subtasks && todo.subtasks.length > 0 ? 
                                `<div class="item-subtitle">${todo.subtasks.filter(st => st.completed).length}/${todo.subtasks.length} ä¸ªå­ä»»åŠ¡</div>` : ''}
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editTodo(${todo.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteTodo(${todo.id})">åˆ é™¤</button>
                        </div>
                    `;
                    todoContainer.appendChild(div);
                });
            }
            
            // æ¸²æŸ“æŠ€èƒ½åˆ—è¡¨
            const skillContainer = document.getElementById('skillListContainer');
            skillContainer.innerHTML = '';
            
            if (appData.study.skills.length === 0) {
                skillContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ¯</div>
                        <p>æš‚æ— æƒ³å­¦æŠ€èƒ½</p>
                    </div>
                `;
            } else {
                appData.study.skills.forEach(skill => {
                    const div = document.createElement('div');
                    div.className = 'todo-item';
                    div.innerHTML = `
                        <div class="item-content">
                            <div class="item-title">${skill.name}</div>
                            ${skill.steps && skill.steps.length > 0 ? 
                                `<div class="item-subtitle">${skill.steps.length} ä¸ªå­¦ä¹ æ­¥éª¤</div>` : 
                                `<div class="item-subtitle">æš‚æ— å­¦ä¹ æ­¥éª¤</div>`}
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editSkill(${skill.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteSkill(${skill.id})">åˆ é™¤</button>
                        </div>
                    `;
                    skillContainer.appendChild(div);
                });
            }
            
            // æ›´æ–°ä»ªè¡¨ç›˜çŠ¶æ€
            const today = new Date().toISOString().split('T')[0];
            const todayTodos = appData.study.todos.filter(todo => !todo.completed);
            const todayStudyTime = appData.study.studyRecords
                .filter(record => record.date === today)
                .reduce((sum, record) => sum + record.duration, 0);
            
            appData.dashboard.todayStatus[0].value = `ä»Šæ—¥å·²å­¦ ${(todayStudyTime / 60).toFixed(1)} å°æ—¶ | å¾…åŠ ${todayTodos.length} é¡¹`;
            
            renderDashboard();
        }
        
        function renderJournalModule() {
            // æ¸²æŸ“æ—¥è®°æœ¬åˆ—è¡¨
            const notebookList = document.getElementById('notebookListContainer');
            const notebookSelect = document.getElementById('journalNotebookSelect');
            
            notebookList.innerHTML = '';
            notebookSelect.innerHTML = '';
            
            appData.journal.notebooks.forEach(notebook => {
                // è®¡ç®—è¯¥æ—¥è®°æœ¬çš„æ—¥è®°æ•°é‡
                const count = appData.journal.entries.filter(entry => entry.notebookId === notebook.id).length;
                
                // æ·»åŠ åˆ°æ—¥è®°æœ¬åˆ—è¡¨
                const div = document.createElement('div');
                div.className = `notebook-item ${notebook.id === appData.journal.currentNotebookId ? 'active' : ''}`;
                div.innerHTML = `
                    <span>${notebook.name} (${count})</span>
                    <div>
                        <button class="btn btn-edit btn-sm" onclick="editNotebook(${notebook.id})">ç¼–è¾‘</button>
                        ${notebook.id !== 1 ? `<button class="btn btn-delete btn-sm" onclick="deleteNotebook(${notebook.id})">åˆ é™¤</button>` : ''}
                    </div>
                `;
                div.onclick = () => selectNotebook(notebook.id);
                notebookList.appendChild(div);
                
                // æ·»åŠ åˆ°ä¸‹æ‹‰é€‰æ‹©
                const option = document.createElement('option');
                option.value = notebook.id;
                option.textContent = notebook.name;
                if (notebook.id === appData.journal.currentNotebookId) option.selected = true;
                notebookSelect.appendChild(option);
            });
            
            // æ¸²æŸ“æ—¥è®°åˆ—è¡¨
            renderJournalList();
            
            // æ›´æ–°ä»ªè¡¨ç›˜çŠ¶æ€
            const currentMonth = new Date().getMonth() + 1;
            const monthEntries = appData.journal.entries.filter(entry => {
                const entryMonth = new Date(entry.date).getMonth() + 1;
                return entryMonth === currentMonth;
            });
            
            appData.dashboard.todayStatus[2].value = `æœ¬æœˆå·²å†™ ${monthEntries.length} ç¯‡`;
            
            renderDashboard();
        }
        
        function renderJournalList() {
            const journalList = document.getElementById('journalListContainer');
            journalList.innerHTML = '';
            
            // è·å–å½“å‰æ—¥è®°æœ¬çš„æ—¥è®°
            const currentNotebookEntries = appData.journal.entries
                .filter(entry => entry.notebookId === appData.journal.currentNotebookId)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10); // åªæ˜¾ç¤ºæœ€è¿‘10ç¯‡
            
            if (currentNotebookEntries.length === 0) {
                journalList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“„</div>
                        <p>æš‚æ— æ—¥è®°</p>
                    </div>
                `;
            } else {
                currentNotebookEntries.forEach(entry => {
                    const div = document.createElement('div');
                    div.className = 'journal-item';
                    div.innerHTML = `
                        <div class="item-content">
                            <div class="item-title">${entry.title || 'æ— æ ‡é¢˜æ—¥è®°'}</div>
                            <div class="item-subtitle">${entry.date} â€¢ ${getEmotionText(entry.emotion)}</div>
                            <div class="item-subtitle" style="margin-top: 5px; color: #666; font-size: 0.9em;">
                                ${entry.content.substring(0, 100)}${entry.content.length > 100 ? '...' : ''}
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editJournal(${entry.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteJournal(${entry.id})">åˆ é™¤</button>
                        </div>
                    `;
                    journalList.appendChild(div);
                });
            }
        }
        
        function renderFinanceModule() {
            // æ¸²æŸ“è´¦æˆ·åˆ—è¡¨
            const accountsContainer = document.getElementById('accountsGridContainer');
            const accountSelect = document.getElementById('transactionAccount');
            const targetAccountSelect = document.getElementById('transactionTargetAccount');
            
            accountsContainer.innerHTML = '';
            accountSelect.innerHTML = '';
            targetAccountSelect.innerHTML = '<option value="">é€‰æ‹©ç›®æ ‡è´¦æˆ·</option>';
            
            if (appData.finance.accounts.length === 0) {
                accountsContainer.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">ğŸ¦</div>
                        <p>æš‚æ— è´¦æˆ·</p>
                        <button class="btn btn-primary mt-10" onclick="showAccountModal()">æ·»åŠ ç¬¬ä¸€ä¸ªè´¦æˆ·</button>
                    </div>
                `;
            } else {
                appData.finance.accounts.forEach(account => {
                    // æ·»åŠ åˆ°è´¦æˆ·ç½‘æ ¼
                    const div = document.createElement('div');
                    div.className = 'account-card';
                    div.innerHTML = `
                        <div class="account-name">
                            <span>${account.icon}</span>
                            ${account.name}
                        </div>
                        <div class="account-balance">Â¥ ${account.balance.toFixed(2)}</div>
                        <div class="mt-10 d-flex gap-10">
                            <button class="btn btn-edit btn-sm" onclick="editAccount(${account.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteAccount(${account.id})">åˆ é™¤</button>
                        </div>
                    `;
                    accountsContainer.appendChild(div);
                    
                    // æ·»åŠ åˆ°ä¸‹æ‹‰é€‰æ‹©
                    const option1 = document.createElement('option');
                    option1.value = account.id;
                    option1.textContent = `${account.name} (Â¥${account.balance.toFixed(2)})`;
                    accountSelect.appendChild(option1.cloneNode(true));
                    
                    const option2 = document.createElement('option');
                    option2.value = account.id;
                    option2.textContent = `${account.name} (Â¥${account.balance.toFixed(2)})`;
                    targetAccountSelect.appendChild(option2);
                });
            }
            
            // æ¸²æŸ“äº¤æ˜“è®°å½•
            renderTransactionList();
            
            // æ¸²æŸ“å¿ƒæ„¿å•
            renderWishlist();
            
            // æ›´æ–°æ€»èµ„äº§
            renderDashboard();
        }
        
        function renderTransactionList() {
            const container = document.getElementById('transactionListContainer');
            container.innerHTML = '';
            
            const recentTransactions = [...appData.finance.transactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            if (recentTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¸</div>
                        <p>æš‚æ— äº¤æ˜“è®°å½•</p>
                    </div>
                `;
            } else {
                recentTransactions.forEach(transaction => {
                    const account = appData.finance.accounts.find(acc => acc.id === transaction.accountId);
                    const targetAccount = transaction.targetAccountId ? 
                        appData.finance.accounts.find(acc => acc.id === transaction.targetAccountId) : null;
                    
                    const div = document.createElement('div');
                    div.className = 'transaction-item';
                    div.innerHTML = `
                        <div class="item-content">
                            <div class="item-title">
                                <span style="color: ${transaction.type === 'income' ? 'green' : transaction.type === 'expense' ? 'red' : 'blue'}">
                                    ${transaction.type === 'income' ? 'â¬†ï¸' : transaction.type === 'expense' ? 'â¬‡ï¸' : 'ğŸ”„'}
                                </span>
                                ${transaction.category} â€¢ Â¥${transaction.amount.toFixed(2)}
                            </div>
                            <div class="item-subtitle">
                                ${transaction.date} â€¢ ${account?.name || 'æœªçŸ¥è´¦æˆ·'}
                                ${targetAccount ? ` â†’ ${targetAccount.name}` : ''}
                                ${transaction.note ? ` â€¢ ${transaction.note}` : ''}
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editTransaction(${transaction.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteTransaction(${transaction.id})">åˆ é™¤</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
        }
        
        function renderWishlist() {
            const container = document.getElementById('wishlistContainer');
            container.innerHTML = '';
            
            if (appData.finance.wishes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ</div>
                        <p>æš‚æ— å¿ƒæ„¿å•</p>
                    </div>
                `;
            } else {
                appData.finance.wishes.forEach(wish => {
                    const progress = (wish.savedAmount / wish.targetAmount * 100).toFixed(0);
                    
                    const div = document.createElement('div');
                    div.className = 'wishlist-item';
                    div.innerHTML = `
                        <input type="checkbox" class="item-checkbox" ${wish.active ? 'checked' : ''} 
                               onchange="toggleWish(${wish.id})">
                        <div class="item-content">
                            <div class="item-title">${wish.name}</div>
                            <div class="item-subtitle">
                                å·²å­˜ Â¥${wish.savedAmount.toFixed(2)} / ç›®æ ‡ Â¥${wish.targetAmount.toFixed(2)}
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editWish(${wish.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteWish(${wish.id})">åˆ é™¤</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
            
            calculateWishlistTotal();
        }
        
        function renderHealthModule() {
            // æ¸²æŸ“è¯å“åˆ—è¡¨
            const medContainer = document.getElementById('medicationListContainer');
            medContainer.innerHTML = '';
            
            if (appData.health.medications.length === 0) {
                medContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’Š</div>
                        <p>ä»Šæ—¥æ— æœè¯è®¡åˆ’</p>
                    </div>
                `;
            } else {
                appData.health.medications.forEach(med => {
                    const div = document.createElement('div');
                    div.className = 'medication-item';
                    div.innerHTML = `
                        <input type="checkbox" class="item-checkbox" ${med.taken ? 'checked' : ''} 
                               onchange="toggleMedication(${med.id})">
                        <div class="item-content">
                            <div class="item-title">${med.name}</div>
                            <div class="item-subtitle">${med.dosage} â€¢ ${med.time} â€¢ ${med.frequency}</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editMedication(${med.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteMedication(${med.id})">åˆ é™¤</button>
                        </div>
                    `;
                    medContainer.appendChild(div);
                });
            }
            
            // æ¸²æŸ“è¿åŠ¨è®¡åˆ’
            const exerciseContainer = document.getElementById('exerciseListContainer');
            exerciseContainer.innerHTML = '';
            
            if (appData.health.exercises.length === 0) {
                exerciseContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸƒ</div>
                        <p>ä»Šæ—¥æ— è¿åŠ¨è®¡åˆ’</p>
                    </div>
                `;
            } else {
                appData.health.exercises.forEach(exercise => {
                    const div = document.createElement('div');
                    div.className = 'exercise-item';
                    div.innerHTML = `
                        <input type="checkbox" class="item-checkbox" ${exercise.completed > 0 ? 'checked' : ''}
                               onchange="toggleExercise(${exercise.id})">
                        <div class="item-content">
                            <div class="item-title">${exercise.name}</div>
                            <div class="item-subtitle">ç›®æ ‡ï¼š${exercise.target}</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editExercise(${exercise.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteExercise(${exercise.id})">åˆ é™¤</button>
                        </div>
                    `;
                    exerciseContainer.appendChild(div);
                });
            }
            
            // æ¸²æŸ“æƒ…ç»ªæ—¥å†
            renderMoodCalendar();
            
            // æ¸²æŸ“èº«ä½“æ•°æ®
            renderBodyData();
            
            // æ›´æ–°ä»ªè¡¨ç›˜çŠ¶æ€
            updateHealthStatus();
        }
        
        function renderMoodCalendar() {
            const container = document.getElementById('calendarGridContainer');
            const monthDisplay = document.getElementById('currentMonthDisplay');
            
            const month = appData.health.currentMonth;
            const year = appData.health.currentYear;
            
            monthDisplay.textContent = `${year}å¹´${month + 1}æœˆ`;
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // è·å–ç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ ï¼ˆ0=å‘¨æ—¥, 1=å‘¨ä¸€, ...ï¼‰
            const firstDayOfWeek = firstDay.getDay();
            
            container.innerHTML = '';
            
            // æ·»åŠ ç©ºçš„æ—¥æœŸæ ¼å­
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'calendar-day empty';
                container.appendChild(emptyDiv);
            }
            
            // æ·»åŠ æ—¥æœŸæ ¼å­
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const mood = appData.health.moodRecords[dateStr];
                
                const dayDiv = document.createElement('div');
                dayDiv.className = `calendar-day ${mood || 'empty'}`;
                dayDiv.textContent = day;
                dayDiv.title = dateStr + (mood ? ` (${getEmotionText(mood)})` : '');
                dayDiv.onclick = () => recordMood(dateStr);
                
                container.appendChild(dayDiv);
            }
        }
        
        function renderBodyData() {
            const container = document.getElementById('bodyDataListContainer');
            container.innerHTML = '';
            
            const recentData = [...appData.health.bodyData]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“ˆ</div>
                        <p>æš‚æ— èº«ä½“æ•°æ®è®°å½•</p>
                    </div>
                `;
            } else {
                recentData.forEach(data => {
                    const div = document.createElement('div');
                    div.className = 'todo-item';
                    div.innerHTML = `
                        <div class="item-content">
                            <div class="item-title">${data.date}</div>
                            <div class="item-subtitle">
                                ä½“é‡ï¼š${data.weight}kg ${data.fat ? `| ä½“è„‚ï¼š${data.fat}%` : ''}
                                ${data.note ? `| ${data.note}` : ''}
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-edit btn-sm" onclick="editBodyData(${data.id})">ç¼–è¾‘</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteBodyData(${data.id})">åˆ é™¤</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
        }
        
        function renderSettingsModule() {
            updateStorageInfo();
        }
        
        // ===== ç¼–è¾‘å‡½æ•° =====
        function editTotalAssets() {
            showModal('ç¼–è¾‘æ€»èµ„äº§', 'ğŸ’°', `
                <div class="form-group">
                    <label>æ‰‹åŠ¨è®¾ç½®æ€»èµ„äº§ (Â¥)</label>
                    <input type="number" class="form-control" id="editTotalAmount" value="${appData.dashboard.totalAssets}" step="0.01">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveTotalAssets()">ä¿å­˜</button>
            `);
        }
        
        function saveTotalAssets() {
            const amount = parseFloat(document.getElementById('editTotalAmount').value);
            if (!isNaN(amount)) {
                // è®¡ç®—å·®å€¼å¹¶è°ƒæ•´ç¬¬ä¸€ä¸ªè´¦æˆ·çš„ä½™é¢
                const diff = amount - appData.dashboard.totalAssets;
                if (appData.finance.accounts.length > 0) {
                    appData.finance.accounts[0].balance += diff;
                }
                renderFinanceModule();
                closeModal();
            }
        }
        
        function editQuickActions() {
            const actionsHTML = appData.dashboard.quickActions.map(action => `
                <div class="form-row" style="align-items: center;">
                    <div class="form-group">
                        <input type="text" class="form-control" value="${action.name}" 
                               onchange="updateQuickAction(${action.id}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" value="${action.icon}" 
                               onchange="updateQuickAction(${action.id}, 'icon', this.value)" style="max-width: 80px;">
                    </div>
                    <div class="form-group">
                        <select class="form-control" onchange="updateQuickAction(${action.id}, 'action', this.value)">
                            <option value="journal" ${action.action === 'journal' ? 'selected' : ''}>å†™æ—¥è®°</option>
                            <option value="finance" ${action.action === 'finance' ? 'selected' : ''}>å¿«é€Ÿè®°è´¦</option>
                            <option value="timer" ${action.action === 'timer' ? 'selected' : ''}>å¼€å§‹è®¡æ—¶</option>
                            <option value="health" ${action.action === 'health' ? 'selected' : ''}>åƒè¯æ‰“å¡</option>
                        </select>
                    </div>
                    <button class="btn btn-delete btn-sm" onclick="deleteQuickAction(${action.id})">åˆ é™¤</button>
                </div>
            `).join('');
            
            showModal('ç¼–è¾‘å¿«æ·æ“ä½œ', 'âš¡', `
                <div class="form-group">
                    <label>å¿«æ·æ“ä½œåˆ—è¡¨</label>
                    ${actionsHTML}
                </div>
                <button class="btn btn-secondary w-100" onclick="addQuickAction()">+ æ·»åŠ å¿«æ·æ“ä½œ</button>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="closeModal(); renderDashboard()">å®Œæˆ</button>
            `);
        }
        
        function updateQuickAction(id, field, value) {
            const action = appData.dashboard.quickActions.find(a => a.id === id);
            if (action) {
                action[field] = value;
                saveData();
            }
        }
        
        function deleteQuickAction(id) {
            appData.dashboard.quickActions = appData.dashboard.quickActions.filter(a => a.id !== id);
            saveData();
            editQuickActions(); // é‡æ–°æ‰“å¼€ç¼–è¾‘çª—å£
        }
        
        function addQuickAction() {
            const newId = appData.dashboard.quickActions.length > 0 
                ? Math.max(...appData.dashboard.quickActions.map(a => a.id)) + 1 
                : 1;
            appData.dashboard.quickActions.push({
                id: newId,
                name: 'æ–°æ“ä½œ',
                icon: 'âœ¨',
                action: 'journal'
            });
            saveData();
            editQuickActions(); // é‡æ–°æ‰“å¼€ç¼–è¾‘çª—å£
        }
        
        function editTodayStatus() {
            const statusHTML = appData.dashboard.todayStatus.map(status => `
                <div class="form-row" style="align-items: center;">
                    <div class="form-group">
                        <label>æ ‡é¢˜</label>
                        <input type="text" class="form-control" value="${status.title}" 
                               onchange="updateTodayStatus(${status.id}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <label>å†…å®¹</label>
                        <input type="text" class="form-control" value="${status.value}" 
                               onchange="updateTodayStatus(${status.id}, 'value', this.value)">
                    </div>
                    <button class="btn btn-delete btn-sm" style="margin-top: 25px;" onclick="deleteTodayStatus(${status.id})">åˆ é™¤</button>
                </div>
            `).join('');
            
            showModal('ç¼–è¾‘ä»Šæ—¥çŠ¶æ€', 'ğŸ“Š', `
                <div class="form-group">
                    <label>çŠ¶æ€é¡¹ç›®</label>
                    ${statusHTML}
                </div>
                <button class="btn btn-secondary w-100" onclick="addTodayStatus()">+ æ·»åŠ çŠ¶æ€é¡¹ç›®</button>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="closeModal(); renderDashboard()">å®Œæˆ</button>
            `);
        }
        
        function updateTodayStatus(id, field, value) {
            const status = appData.dashboard.todayStatus.find(s => s.id === id);
            if (status) {
                status[field] = value;
                saveData();
            }
        }
        
        function deleteTodayStatus(id) {
            appData.dashboard.todayStatus = appData.dashboard.todayStatus.filter(s => s.id !== id);
            saveData();
            editTodayStatus();
        }
        
        function addTodayStatus() {
            const newId = appData.dashboard.todayStatus.length > 0 
                ? Math.max(...appData.dashboard.todayStatus.map(s => s.id)) + 1 
                : 1;
            appData.dashboard.todayStatus.push({
                id: newId,
                title: 'æ–°çŠ¶æ€',
                value: 'æœªè®¾ç½®'
            });
            saveData();
            editTodayStatus();
        }
        
        function editStatusItem(id) {
            const status = appData.dashboard.todayStatus.find(s => s.id === id);
            if (!status) return;
            
            showModal('ç¼–è¾‘çŠ¶æ€é¡¹ç›®', 'ğŸ“Š', `
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" class="form-control" id="editStatusTitle" value="${status.title}">
                </div>
                <div class="form-group">
                    <label>å†…å®¹</label>
                    <input type="text" class="form-control" id="editStatusValue" value="${status.value}">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveStatusItem(${id})">ä¿å­˜</button>
            `);
        }
        
        function saveStatusItem(id) {
            const status = appData.dashboard.todayStatus.find(s => s.id === id);
            if (status) {
                status.title = document.getElementById('editStatusTitle').value;
                status.value = document.getElementById('editStatusValue').value;
                saveData();
                renderDashboard();
                closeModal();
            }
        }
        
        // ===== å­¦ä¹ ä¸­å¿ƒç¼–è¾‘å‡½æ•° =====
        function showTodoModal(todoId = null) {
            currentEditItem = todoId ? appData.study.todos.find(t => t.id === todoId) : null;
            currentEditType = 'todo';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘å¾…åŠäº‹é¡¹' : 'æ·»åŠ å¾…åŠäº‹é¡¹', 'âœ…', `
                <div class="form-group">
                    <label>ä»»åŠ¡æ ‡é¢˜</label>
                    <input type="text" class="form-control" id="todoTitle" 
                           value="${isEdit ? currentEditItem.title : ''}" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜">
                </div>
                <div class="form-group">
                    <label>æˆªæ­¢æ—¥æœŸ (å¯é€‰)</label>
                    <input type="date" class="form-control" id="todoDueDate" 
                           value="${isEdit ? currentEditItem.dueDate || '' : ''}">
                </div>
                <div class="form-group">
                    <label>å­ä»»åŠ¡ (æ¯è¡Œä¸€ä¸ªï¼Œå¯é€‰)</label>
                    <textarea class="form-control" id="todoSubtasks" rows="3" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªå­ä»»åŠ¡">${isEdit && currentEditItem.subtasks ? currentEditItem.subtasks.map(st => st.title).join('\n') : ''}</textarea>
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveTodo()">${isEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button>
            `);
        }
        
        function saveTodo() {
            const title = document.getElementById('todoTitle').value.trim();
            if (!title) {
                alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
                return;
            }
            
            const dueDate = document.getElementById('todoDueDate').value;
            const subtasksText = document.getElementById('todoSubtasks').value.trim();
            
            const subtasks = subtasksText ? subtasksText.split('\n')
                .filter(line => line.trim())
                .map((title, index) => ({
                    id: index + 1,
                    title: title.trim(),
                    completed: false
                })) : [];
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰å¾…åŠ
                currentEditItem.title = title;
                currentEditItem.dueDate = dueDate || null;
                currentEditItem.subtasks = subtasks;
            } else {
                // æ·»åŠ æ–°å¾…åŠ
                const newId = appData.study.todos.length > 0 
                    ? Math.max(...appData.study.todos.map(t => t.id)) + 1 
                    : 1;
                
                appData.study.todos.push({
                    id: newId,
                    title,
                    dueDate: dueDate || null,
                    subtasks,
                    completed: false,
                    createdAt: new Date().toISOString()
                });
            }
            
            saveData();
            renderStudyModule();
            closeModal();
        }
        
        function editTodo(id) {
            showTodoModal(id);
        }
        
        function deleteTodo(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¾…åŠäº‹é¡¹å—ï¼Ÿ', () => {
                appData.study.todos = appData.study.todos.filter(t => t.id !== id);
                saveData();
                renderStudyModule();
            });
        }
        
        function toggleTodo(id) {
            const todo = appData.study.todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                saveData();
                renderStudyModule();
            }
        }
        
        function showSkillModal(skillId = null) {
            currentEditItem = skillId ? appData.study.skills.find(s => s.id === skillId) : null;
            currentEditType = 'skill';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘å­¦ä¹ æŠ€èƒ½' : 'æ·»åŠ å­¦ä¹ æŠ€èƒ½', 'ğŸ¯', `
                <div class="form-group">
                    <label>æŠ€èƒ½åç§°</label>
                    <input type="text" class="form-control" id="skillName" 
                           value="${isEdit ? currentEditItem.name : ''}" placeholder="ä¾‹å¦‚ï¼šPythonç¼–ç¨‹">
                </div>
                <div class="form-group">
                    <label>å­¦ä¹ æ­¥éª¤ (æ¯è¡Œä¸€ä¸ªï¼Œå¯é€‰)</label>
                    <textarea class="form-control" id="skillSteps" rows="4" placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªå­¦ä¹ æ­¥éª¤">${isEdit && currentEditItem.steps ? currentEditItem.steps.map(step => step.title).join('\n') : ''}</textarea>
                </div>
                <div class="form-group">
                    <label>é¢„è®¡å­¦ä¹ æ—¶é—´ (å°æ—¶ï¼Œå¯é€‰)</label>
                    <input type="number" class="form-control" id="skillHours" 
                           value="${isEdit ? currentEditItem.hours || '' : ''}" min="0" step="0.5">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveSkill()">${isEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button>
            `);
        }
        
        function saveSkill() {
            const name = document.getElementById('skillName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥æŠ€èƒ½åç§°');
                return;
            }
            
            const stepsText = document.getElementById('skillSteps').value.trim();
            const hours = document.getElementById('skillHours').value;
            
            const steps = stepsText ? stepsText.split('\n')
                .filter(line => line.trim())
                .map((title, index) => ({
                    id: index + 1,
                    title: title.trim(),
                    completed: false
                })) : [];
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰æŠ€èƒ½
                currentEditItem.name = name;
                currentEditItem.steps = steps;
                currentEditItem.hours = hours ? parseFloat(hours) : null;
            } else {
                // æ·»åŠ æ–°æŠ€èƒ½
                const newId = appData.study.skills.length > 0 
                    ? Math.max(...appData.study.skills.map(s => s.id)) + 1 
                    : 1;
                
                appData.study.skills.push({
                    id: newId,
                    name,
                    steps,
                    hours: hours ? parseFloat(hours) : null,
                    createdAt: new Date().toISOString()
                });
            }
            
            saveData();
            renderStudyModule();
            closeModal();
        }
        
        function editSkill(id) {
            showSkillModal(id);
        }
        
        function deleteSkill(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­¦ä¹ æŠ€èƒ½å—ï¼Ÿ', () => {
                appData.study.skills = appData.study.skills.filter(s => s.id !== id);
                saveData();
                renderStudyModule();
            });
        }
        
        function editTimerSettings() {
            showModal('è®¡æ—¶å™¨è®¾ç½®', 'â±ï¸', `
                <div class="form-group">
                    <label>é»˜è®¤è®¡æ—¶æ—¶é•¿ (åˆ†é’Ÿ)</label>
                    <input type="number" class="form-control" id="timerDuration" 
                           value="${appData.study.timerSettings.defaultDuration}" min="1" max="120">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="timerAutoStart" ${appData.study.timerSettings.autoStart ? 'checked' : ''}>
                        è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€ä¸ªè®¡æ—¶
                    </label>
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveTimerSettings()">ä¿å­˜</button>
            `);
        }
        
        function saveTimerSettings() {
            const duration = parseInt(document.getElementById('timerDuration').value);
            const autoStart = document.getElementById('timerAutoStart').checked;
            
            if (duration >= 1 && duration <= 120) {
                appData.study.timerSettings.defaultDuration = duration;
                appData.study.timerSettings.autoStart = autoStart;
                
                // æ›´æ–°å½“å‰è®¡æ—¶å™¨
                timerSeconds = duration * 60;
                updateTimerDisplay();
                
                saveData();
                closeModal();
            } else {
                alert('è¯·è¾“å…¥1-120åˆ†é’Ÿä¹‹é—´çš„æ•°å€¼');
            }
        }
        
        // ===== æ—¥è®°æ¨¡å—ç¼–è¾‘å‡½æ•° =====
        function showNotebookModal(notebookId = null) {
            currentEditItem = notebookId ? appData.journal.notebooks.find(n => n.id === notebookId) : null;
            currentEditType = 'notebook';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘æ—¥è®°æœ¬' : 'æ–°å»ºæ—¥è®°æœ¬', 'ğŸ“š', `
                <div class="form-group">
                    <label>æ—¥è®°æœ¬åç§°</label>
                    <input type="text" class="form-control" id="notebookName" 
                           value="${isEdit ? currentEditItem.name : ''}" placeholder="ä¾‹å¦‚ï¼šæ—¥å¸¸éšç¬”">
                </div>
                <div class="form-group">
                    <label>å°é¢é¢œè‰²</label>
                    <input type="color" class="form-control" id="notebookColor" 
                           value="${isEdit ? currentEditItem.color : '#4a7c59'}" style="height: 40px;">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveNotebook()">${isEdit ? 'ä¿å­˜' : 'åˆ›å»º'}</button>
            `);
        }
        
        function saveNotebook() {
            const name = document.getElementById('notebookName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥æ—¥è®°æœ¬åç§°');
                return;
            }
            
            const color = document.getElementById('notebookColor').value;
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰æ—¥è®°æœ¬
                currentEditItem.name = name;
                currentEditItem.color = color;
            } else {
                // åˆ›å»ºæ–°æ—¥è®°æœ¬
                const newId = appData.journal.notebooks.length > 0 
                    ? Math.max(...appData.journal.notebooks.map(n => n.id)) + 1 
                    : 1;
                
                appData.journal.notebooks.push({
                    id: newId,
                    name,
                    color,
                    count: 0
                });
            }
            
            saveData();
            renderJournalModule();
            closeModal();
        }
        
        function editNotebook(id) {
            showNotebookModal(id);
        }
        
        function deleteNotebook(id) {
            if (id === 1) {
                alert('é»˜è®¤æ—¥è®°æœ¬ä¸èƒ½åˆ é™¤');
                return;
            }
            
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ—¥è®°æœ¬å—ï¼Ÿè¯¥æ—¥è®°æœ¬ä¸­çš„æ‰€æœ‰æ—¥è®°ä¹Ÿå°†è¢«åˆ é™¤ã€‚', () => {
                // åˆ é™¤è¯¥æ—¥è®°æœ¬ä¸­çš„æ‰€æœ‰æ—¥è®°
                appData.journal.entries = appData.journal.entries.filter(entry => entry.notebookId !== id);
                
                // åˆ é™¤æ—¥è®°æœ¬
                appData.journal.notebooks = appData.journal.notebooks.filter(n => n.id !== id);
                
                // å¦‚æœå½“å‰é€‰ä¸­çš„æ—¥è®°æœ¬è¢«åˆ é™¤ï¼Œåˆ‡æ¢åˆ°é»˜è®¤æ—¥è®°æœ¬
                if (appData.journal.currentNotebookId === id) {
                    appData.journal.currentNotebookId = 1;
                }
                
                saveData();
                renderJournalModule();
            });
        }
        
        function selectNotebook(id) {
            appData.journal.currentNotebookId = id;
            saveData();
            renderJournalModule();
        }
        
        function saveJournal() {
            const title = document.getElementById('journalTitle').value.trim();
            const content = document.getElementById('journalContent').value.trim();
            const notebookId = parseInt(document.getElementById('journalNotebookSelect').value);
            
            if (!content) {
                alert('è¯·è¾“å…¥æ—¥è®°å†…å®¹');
                return;
            }
            
            if (!selectedEmotion) {
                alert('è¯·é€‰æ‹©æƒ…ç»ª');
                return;
            }
            
            const newId = appData.journal.entries.length > 0 
                ? Math.max(...appData.journal.entries.map(e => e.id)) + 1 
                : 1;
            
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.toTimeString().split(' ')[0].substring(0, 5);
            
            appData.journal.entries.push({
                id: newId,
                title: title || 'æ— æ ‡é¢˜æ—¥è®°',
                content,
                emotion: selectedEmotion,
                notebookId,
                date: dateStr,
                time: timeStr,
                createdAt: now.toISOString()
            });
            
            // è®°å½•æƒ…ç»ªåˆ°å¥åº·æ¨¡å—
            appData.health.moodRecords[dateStr] = selectedEmotion;
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('journalTitle').value = '';
            document.getElementById('journalContent').value = '';
            document.querySelectorAll('.emotion-btn').forEach(btn => btn.classList.remove('selected'));
            selectedEmotion = null;
            
            saveData();
            renderJournalModule();
            renderHealthModule();
            alert('æ—¥è®°ä¿å­˜æˆåŠŸï¼');
        }
        
        function editJournal(id) {
            const entry = appData.journal.entries.find(e => e.id === id);
            if (!entry) return;
            
            // å¡«å……è¡¨å•
            document.getElementById('journalTitle').value = entry.title;
            document.getElementById('journalContent').value = entry.content;
            
            // é€‰æ‹©æƒ…ç»ª
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent.includes(getEmotionText(entry.emotion))) {
                    btn.classList.add('selected');
                    selectedEmotion = entry.emotion;
                }
            });
            
            // é€‰æ‹©æ—¥è®°æœ¬
            document.getElementById('journalNotebookSelect').value = entry.notebookId;
            
            // åˆ‡æ¢åˆ°æ—¥è®°æ¨¡å—
            switchTab('journal');
            
            // æ»šåŠ¨åˆ°ç¼–è¾‘å™¨
            document.getElementById('journalContent').focus();
        }
        
        function deleteJournal(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ', () => {
                appData.journal.entries = appData.journal.entries.filter(e => e.id !== id);
                saveData();
                renderJournalModule();
            });
        }
        
        function refreshJournals() {
            renderJournalList();
        }
        
        // ===== è´¢äº§ç®¡ç†ç¼–è¾‘å‡½æ•° =====
        function showAccountModal(accountId = null) {
            currentEditItem = accountId ? appData.finance.accounts.find(a => a.id === accountId) : null;
            currentEditType = 'account';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘è´¦æˆ·' : 'æ·»åŠ è´¦æˆ·', 'ğŸ¦', `
                <div class="form-group">
                    <label>è´¦æˆ·åç§°</label>
                    <input type="text" class="form-control" id="accountName" 
                           value="${isEdit ? currentEditItem.name : ''}" placeholder="ä¾‹å¦‚ï¼šå¾®ä¿¡é’±åŒ…">
                </div>
                <div class="form-group">
                    <label>è´¦æˆ·å›¾æ ‡</label>
                    <select class="form-control" id="accountIcon">
                        <option value="ğŸ’³" ${isEdit && currentEditItem.icon === 'ğŸ’³' ? 'selected' : ''}>ğŸ’³ å¡ç‰‡</option>
                        <option value="ğŸ’µ" ${isEdit && currentEditItem.icon === 'ğŸ’µ' ? 'selected' : ''}>ğŸ’µ ç°é‡‘</option>
                        <option value="ğŸ¦" ${isEdit && currentEditItem.icon === 'ğŸ¦' ? 'selected' : ''}>ğŸ¦ é“¶è¡Œ</option>
                        <option value="ğŸ’°" ${isEdit && currentEditItem.icon === 'ğŸ’°' ? 'selected' : ''}>ğŸ’° é’±åŒ…</option>
                        <option value="ğŸ“±" ${isEdit && currentEditItem.icon === 'ğŸ“±' ? 'selected' : ''}>ğŸ“± æ‰‹æœº</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è´¦æˆ·ç±»å‹</label>
                    <select class="form-control" id="accountType">
                        <option value="digital" ${isEdit && currentEditItem.type === 'digital' ? 'selected' : ''}>æ•°å­—é’±åŒ…</option>
                        <option value="cash" ${isEdit && currentEditItem.type === 'cash' ? 'selected' : ''}>ç°é‡‘</option>
                        <option value="bank" ${isEdit && currentEditItem.type === 'bank' ? 'selected' : ''}>é“¶è¡Œå¡</option>
                        <option value="investment" ${isEdit && currentEditItem.type === 'investment' ? 'selected' : ''}>æŠ•èµ„è´¦æˆ·</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>åˆå§‹ä½™é¢ (Â¥)</label>
                    <input type="number" class="form-control" id="accountBalance" 
                           value="${isEdit ? currentEditItem.balance : '0'}" step="0.01">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveAccount()">${isEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button>
            `);
        }
        
        function saveAccount() {
            const name = document.getElementById('accountName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥è´¦æˆ·åç§°');
                return;
            }
            
            const icon = document.getElementById('accountIcon').value;
            const type = document.getElementById('accountType').value;
            const balance = parseFloat(document.getElementById('accountBalance').value) || 0;
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰è´¦æˆ·
                currentEditItem.name = name;
                currentEditItem.icon = icon;
                currentEditItem.type = type;
                currentEditItem.balance = balance;
            } else {
                // æ·»åŠ æ–°è´¦æˆ·
                const newId = appData.finance.accounts.length > 0 
                    ? Math.max(...appData.finance.accounts.map(a => a.id)) + 1 
                    : 1;
                
                appData.finance.accounts.push({
                    id: newId,
                    name,
                    icon,
                    type,
                    balance
                });
            }
            
            saveData();
            renderFinanceModule();
            closeModal();
        }
        
        function editAccount(id) {
            showAccountModal(id);
        }
        
        function deleteAccount(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦æˆ·å—ï¼Ÿè¯¥è´¦æˆ·çš„æ‰€æœ‰äº¤æ˜“è®°å½•ä¹Ÿå°†è¢«åˆ é™¤ã€‚', () => {
                // åˆ é™¤ç›¸å…³äº¤æ˜“è®°å½•
                appData.finance.transactions = appData.finance.transactions.filter(t => 
                    t.accountId !== id && t.targetAccountId !== id
                );
                
                // åˆ é™¤è´¦æˆ·
                appData.finance.accounts = appData.finance.accounts.filter(a => a.id !== id);
                
                saveData();
                renderFinanceModule();
            });
        }
        
        function addTransaction() {
            const type = document.getElementById('transactionType').value;
            const category = document.getElementById('transactionCategory').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const accountId = parseInt(document.getElementById('transactionAccount').value);
            const targetAccountId = type === 'transfer' ? parseInt(document.getElementById('transactionTargetAccount').value) : null;
            const date = document.getElementById('transactionDate').value;
            const note = document.getElementById('transactionNote').value.trim();
            
            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢');
                return;
            }
            
            if (!accountId) {
                alert('è¯·é€‰æ‹©è´¦æˆ·');
                return;
            }
            
            if (type === 'transfer' && (!targetAccountId || targetAccountId === accountId)) {
                alert('è¯·é€‰æ‹©ä¸åŒçš„ç›®æ ‡è´¦æˆ·');
                return;
            }
            
            const account = appData.finance.accounts.find(a => a.id === accountId);
            if (!account) {
                alert('è´¦æˆ·ä¸å­˜åœ¨');
                return;
            }
            
            // æ£€æŸ¥ä½™é¢
            if (type === 'expense' && account.balance < amount) {
                if (!confirm('è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œæ˜¯å¦ç»§ç»­è®°å½•ï¼Ÿ')) return;
            }
            
            const newId = appData.finance.transactions.length > 0 
                ? Math.max(...appData.finance.transactions.map(t => t.id)) + 1 
                : 1;
            
            // åˆ›å»ºäº¤æ˜“è®°å½•
            const transaction = {
                id: newId,
                type,
                category,
                amount,
                accountId,
                targetAccountId,
                date: date || new Date().toISOString().split('T')[0],
                note,
                createdAt: new Date().toISOString()
            };
            
            appData.finance.transactions.push(transaction);
            
            // æ›´æ–°è´¦æˆ·ä½™é¢
            switch(type) {
                case 'income':
                    account.balance += amount;
                    break;
                case 'expense':
                    account.balance -= amount;
                    break;
                case 'transfer':
                    account.balance -= amount;
                    const targetAccount = appData.finance.accounts.find(a => a.id === targetAccountId);
                    if (targetAccount) {
                        targetAccount.balance += amount;
                    }
                    break;
            }
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('transactionAmount').value = '';
            document.getElementById('transactionNote').value = '';
            
            saveData();
            renderFinanceModule();
            alert('äº¤æ˜“è®°å½•æˆåŠŸï¼');
        }
        
        function editTransaction(id) {
            const transaction = appData.finance.transactions.find(t => t.id === id);
            if (!transaction) return;
            
            showModal('ç¼–è¾‘äº¤æ˜“è®°å½•', 'ğŸ’¸', `
                <div class="form-group">
                    <label>ç±»å‹</label>
                    <select class="form-control" id="editTransType" value="${transaction.type}">
                        <option value="expense" ${transaction.type === 'expense' ? 'selected' : ''}>æ”¯å‡º</option>
                        <option value="income" ${transaction.type === 'income' ? 'selected' : ''}>æ”¶å…¥</option>
                        <option value="transfer" ${transaction.type === 'transfer' ? 'selected' : ''}>è½¬è´¦</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>åˆ†ç±»</label>
                    <select class="form-control" id="editTransCategory">
                        ${appData.finance.categories.map(cat => 
                            `<option value="${cat}" ${transaction.category === cat ? 'selected' : ''}>${cat}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>é‡‘é¢ (Â¥)</label>
                    <input type="number" class="form-control" id="editTransAmount" value="${transaction.amount}" step="0.01">
                </div>
                <div class="form-group">
                    <label>æ—¥æœŸ</label>
                    <input type="date" class="form-control" id="editTransDate" value="${transaction.date}">
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <input type="text" class="form-control" id="editTransNote" value="${transaction.note || ''}">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveTransaction(${id})">ä¿å­˜</button>
            `);
        }
        
        function saveTransaction(id) {
            // å®ç°äº¤æ˜“è®°å½•ç¼–è¾‘é€»è¾‘
            alert('äº¤æ˜“è®°å½•ç¼–è¾‘åŠŸèƒ½å¾…å®ç°');
            closeModal();
        }
        
        function deleteTransaction(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™æ¡äº¤æ˜“è®°å½•å—ï¼Ÿ', () => {
                // è¿™é‡Œéœ€è¦å®ç°åå‘æ›´æ–°è´¦æˆ·ä½™é¢çš„é€»è¾‘
                appData.finance.transactions = appData.finance.transactions.filter(t => t.id !== id);
                saveData();
                renderFinanceModule();
            });
        }
        
        function refreshTransactions() {
            renderTransactionList();
        }
        
        function showWishModal(wishId = null) {
            currentEditItem = wishId ? appData.finance.wishes.find(w => w.id === wishId) : null;
            currentEditType = 'wish';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘å¿ƒæ„¿' : 'æ·»åŠ å¿ƒæ„¿', 'ğŸ', `
                <div class="form-group">
                    <label>å¿ƒæ„¿åç§°</label>
                    <input type="text" class="form-control" id="wishName" 
                           value="${isEdit ? currentEditItem.name : ''}" placeholder="ä¾‹å¦‚ï¼šæ–°æ‰‹æœº">
                </div>
                <div class="form-group">
                    <label>ç›®æ ‡é‡‘é¢ (Â¥)</label>
                    <input type="number" class="form-control" id="wishTarget" 
                           value="${isEdit ? currentEditItem.targetAmount : ''}" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label>å·²å­˜é‡‘é¢ (Â¥)</label>
                    <input type="number" class="form-control" id="wishSaved" 
                           value="${isEdit ? currentEditItem.savedAmount : '0'}" step="0.01" min="0">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveWish()">${isEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button>
            `);
        }
        
        function saveWish() {
            const name = document.getElementById('wishName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥å¿ƒæ„¿åç§°');
                return;
            }
            
            const target = parseFloat(document.getElementById('wishTarget').value);
            const saved = parseFloat(document.getElementById('wishSaved').value) || 0;
            
            if (!target || target <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç›®æ ‡é‡‘é¢');
                return;
            }
            
            if (saved > target) {
                alert('å·²å­˜é‡‘é¢ä¸èƒ½è¶…è¿‡ç›®æ ‡é‡‘é¢');
                return;
            }
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰å¿ƒæ„¿
                currentEditItem.name = name;
                currentEditItem.targetAmount = target;
                currentEditItem.savedAmount = saved;
            } else {
                // æ·»åŠ æ–°å¿ƒæ„¿
                const newId = appData.finance.wishes.length > 0 
                    ? Math.max(...appData.finance.wishes.map(w => w.id)) + 1 
                    : 1;
                
                appData.finance.wishes.push({
                    id: newId,
                    name,
                    targetAmount: target,
                    savedAmount: saved,
                    active: true
                });
            }
            
            saveData();
            renderFinanceModule();
            closeModal();
        }
        
        function editWish(id) {
            showWishModal(id);
        }
        
        function deleteWish(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¿ƒæ„¿å—ï¼Ÿ', () => {
                appData.finance.wishes = appData.finance.wishes.filter(w => w.id !== id);
                saveData();
                renderFinanceModule();
            });
        }
        
        function toggleWish(id) {
            const wish = appData.finance.wishes.find(w => w.id === id);
            if (wish) {
                wish.active = !wish.active;
                saveData();
                renderFinanceModule();
            }
        }
        
        function calculateWishlistTotal() {
            const total = appData.finance.wishes
                .filter(w => w.active)
                .reduce((sum, w) => sum + w.targetAmount, 0);
            document.getElementById('wishlistTotal').textContent = `Â¥ ${total.toFixed(2)}`;
        }
        
        // ===== å¥åº·ç®¡ç†ç¼–è¾‘å‡½æ•° =====
        function showMedicationModal(medicationId = null) {
            currentEditItem = medicationId ? appData.health.medications.find(m => m.id === medicationId) : null;
            currentEditType = 'medication';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘è¯å“' : 'æ·»åŠ è¯å“', 'ğŸ’Š', `
                <div class="form-group">
                    <label>è¯å“åç§°</label>
                    <input type="text" class="form-control" id="medName" 
                           value="${isEdit ? currentEditItem.name : ''}" placeholder="ä¾‹å¦‚ï¼šé˜¿è«è¥¿æ—">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æœç”¨å‰‚é‡</label>
                        <input type="text" class="form-control" id="medDosage" 
                               value="${isEdit ? currentEditItem.dosage : ''}" placeholder="ä¾‹å¦‚ï¼š1ç²’">
                    </div>
                    <div class="form-group">
                        <label>æœç”¨æ—¶é—´</label>
                        <input type="time" class="form-control" id="medTime" 
                               value="${isEdit ? currentEditItem.time : '08:00'}">
                    </div>
                </div>
                <div class="form-group">
                    <label>æœç”¨é¢‘ç‡</label>
                    <select class="form-control" id="medFrequency">
                        <option value="æ¯æ—¥ä¸€æ¬¡" ${isEdit && currentEditItem.frequency === 'æ¯æ—¥ä¸€æ¬¡' ? 'selected' : ''}>æ¯æ—¥ä¸€æ¬¡</option>
                        <option value="æ¯æ—¥ä¸¤æ¬¡" ${isEdit && currentEditItem.frequency === 'æ¯æ—¥ä¸¤æ¬¡' ? 'selected' : ''}>æ¯æ—¥ä¸¤æ¬¡</option>
                        <option value="æ¯æ—¥ä¸‰æ¬¡" ${isEdit && currentEditItem.frequency === 'æ¯æ—¥ä¸‰æ¬¡' ? 'selected' : ''}>æ¯æ—¥ä¸‰æ¬¡</option>
                        <option value="æ¯å‘¨ä¸€æ¬¡" ${isEdit && currentEditItem.frequency === 'æ¯å‘¨ä¸€æ¬¡' ? 'selected' : ''}>æ¯å‘¨ä¸€æ¬¡</option>
                        <option value="æŒ‰éœ€æœç”¨" ${isEdit && currentEditItem.frequency === 'æŒ‰éœ€æœç”¨' ? 'selected' : ''}>æŒ‰éœ€æœç”¨</option>
                    </select>
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveMedication()">${isEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button>
            `);
        }
        
        function saveMedication() {
            const name = document.getElementById('medName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥è¯å“åç§°');
                return;
            }
            
            const dosage = document.getElementById('medDosage').value.trim();
            const time = document.getElementById('medTime').value;
            const frequency = document.getElementById('medFrequency').value;
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰è¯å“
                currentEditItem.name = name;
                currentEditItem.dosage = dosage;
                currentEditItem.time = time;
                currentEditItem.frequency = frequency;
            } else {
                // æ·»åŠ æ–°è¯å“
                const newId = appData.health.medications.length > 0 
                    ? Math.max(...appData.health.medications.map(m => m.id)) + 1 
                    : 1;
                
                appData.health.medications.push({
                    id: newId,
                    name,
                    dosage,
                    time,
                    frequency,
                    taken: false
                });
            }
            
            saveData();
            renderHealthModule();
            closeModal();
        }
        
        function editMedication(id) {
            showMedicationModal(id);
        }
        
        function deleteMedication(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¯å“å—ï¼Ÿ', () => {
                appData.health.medications = appData.health.medications.filter(m => m.id !== id);
                saveData();
                renderHealthModule();
            });
        }
        
        function toggleMedication(id) {
            const med = appData.health.medications.find(m => m.id === id);
            if (med) {
                med.taken = !med.taken;
                saveData();
                renderHealthModule();
            }
        }
        
        function markAllMedications() {
            appData.health.medications.forEach(med => med.taken = true);
            saveData();
            renderHealthModule();
            alert('å…¨éƒ¨è¯å“å·²æ ‡è®°ä¸ºå®Œæˆï¼');
        }
        
        function showExerciseModal(exerciseId = null) {
            currentEditItem = exerciseId ? appData.health.exercises.find(e => e.id === exerciseId) : null;
            currentEditType = 'exercise';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘è¿åŠ¨é¡¹ç›®' : 'æ·»åŠ è¿åŠ¨é¡¹ç›®', 'ğŸƒ', `
                <div class="form-group">
                    <label>è¿åŠ¨åç§°</label>
                    <input type="text" class="form-control" id="exerciseName" 
                           value="${isEdit ? currentEditItem.name : ''}" placeholder="ä¾‹å¦‚ï¼šä¿¯å§æ’‘">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>è¿åŠ¨ç±»å‹</label>
                        <select class="form-control" id="exerciseType">
                            <option value="strength" ${isEdit && currentEditItem.type === 'strength' ? 'selected' : ''}>åŠ›é‡è®­ç»ƒ</option>
                            <option value="cardio" ${isEdit && currentEditItem.type === 'cardio' ? 'selected' : ''}>æœ‰æ°§è¿åŠ¨</option>
                            <option value="flexibility" ${isEdit && currentEditItem.type === 'flexibility' ? 'selected' : ''}>æŸ”éŸ§æ€§è®­ç»ƒ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç›®æ ‡</label>
                        <input type="text" class="form-control" id="exerciseTarget" 
                               value="${isEdit ? currentEditItem.target : ''}" placeholder="ä¾‹å¦‚ï¼š3ç»„Ã—15ä¸ª æˆ– 30åˆ†é’Ÿ">
                    </div>
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveExercise()">${isEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button>
            `);
        }
        
        function saveExercise() {
            const name = document.getElementById('exerciseName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥è¿åŠ¨åç§°');
                return;
            }
            
            const type = document.getElementById('exerciseType').value;
            const target = document.getElementById('exerciseTarget').value.trim();
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰è¿åŠ¨
                currentEditItem.name = name;
                currentEditItem.type = type;
                currentEditItem.target = target;
            } else {
                // æ·»åŠ æ–°è¿åŠ¨
                const newId = appData.health.exercises.length > 0 
                    ? Math.max(...appData.health.exercises.map(e => e.id)) + 1 
                    : 1;
                
                appData.health.exercises.push({
                    id: newId,
                    name,
                    type,
                    target,
                    completed: 0
                });
            }
            
            saveData();
            renderHealthModule();
            closeModal();
        }
        
        function editExercise(id) {
            showExerciseModal(id);
        }
        
        function deleteExercise(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¿åŠ¨é¡¹ç›®å—ï¼Ÿ', () => {
                appData.health.exercises = appData.health.exercises.filter(e => e.id !== id);
                saveData();
                renderHealthModule();
            });
        }
        
        function toggleExercise(id) {
            const exercise = appData.health.exercises.find(e => e.id === id);
            if (exercise) {
                exercise.completed = exercise.completed > 0 ? 0 : 1;
                saveData();
                renderHealthModule();
            }
        }
        
        function showBodyDataModal(dataId = null) {
            currentEditItem = dataId ? appData.health.bodyData.find(d => d.id === dataId) : null;
            currentEditType = 'bodyData';
            
            const isEdit = !!currentEditItem;
            
            showModal(isEdit ? 'ç¼–è¾‘èº«ä½“æ•°æ®' : 'æ·»åŠ èº«ä½“æ•°æ®', 'ğŸ“ˆ', `
                <div class="form-group">
                    <label>è®°å½•æ—¥æœŸ</label>
                    <input type="date" class="form-control" id="bodyDataDate" 
                           value="${isEdit ? currentEditItem.date : new Date().toISOString().split('T')[0]}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä½“é‡ (kg)</label>
                        <input type="number" class="form-control" id="bodyDataWeight" 
                               value="${isEdit ? currentEditItem.weight : ''}" step="0.1" min="0">
                    </div>
                    <div class="form-group">
                        <label>ä½“è„‚ç‡ (%)</label>
                        <input type="number" class="form-control" id="bodyDataFat" 
                               value="${isEdit ? currentEditItem.fat || '' : ''}" step="0.1" min="0" max="100">
                    </div>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨ (å¯é€‰)</label>
                    <input type="text" class="form-control" id="bodyDataNote" 
                           value="${isEdit ? currentEditItem.note || '' : ''}" placeholder="ä¾‹å¦‚ï¼šå¥èº«ç¬¬3å¤©">
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveBodyData()">${isEdit ? 'ä¿å­˜' : 'æ·»åŠ '}</button>
            `);
        }
        
        function saveBodyData() {
            const date = document.getElementById('bodyDataDate').value;
            const weight = parseFloat(document.getElementById('bodyDataWeight').value);
            const fat = document.getElementById('bodyDataFat').value ? parseFloat(document.getElementById('bodyDataFat').value) : null;
            const note = document.getElementById('bodyDataNote').value.trim();
            
            if (!weight || weight <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆä½“é‡');
                return;
            }
            
            if (currentEditItem) {
                // ç¼–è¾‘ç°æœ‰æ•°æ®
                currentEditItem.date = date;
                currentEditItem.weight = weight;
                currentEditItem.fat = fat;
                currentEditItem.note = note;
            } else {
                // æ·»åŠ æ–°æ•°æ®
                const newId = appData.health.bodyData.length > 0 
                    ? Math.max(...appData.health.bodyData.map(d => d.id)) + 1 
                    : 1;
                
                appData.health.bodyData.push({
                    id: newId,
                    date,
                    weight,
                    fat,
                    note,
                    createdAt: new Date().toISOString()
                });
            }
            
            saveData();
            renderHealthModule();
            closeModal();
        }
        
        function editBodyData(id) {
            showBodyDataModal(id);
        }
        
        function deleteBodyData(id) {
            showConfirmModal('ç¡®è®¤åˆ é™¤', 'ç¡®å®šè¦åˆ é™¤è¿™æ¡èº«ä½“æ•°æ®å—ï¼Ÿ', () => {
                appData.health.bodyData = appData.health.bodyData.filter(d => d.id !== id);
                saveData();
                renderHealthModule();
            });
        }
        
        function updateHealthStatus() {
            // æ›´æ–°ä»Šæ—¥å¥åº·çŠ¶æ€
            const today = new Date().toISOString().split('T')[0];
            const todayMood = appData.health.moodRecords[today];
            
            appData.dashboard.todayStatus[1].value = `ç¡çœ  -- | å–æ°´ --/8 æ¯`;
            appData.dashboard.todayStatus[3].value = todayMood ? `${getEmotionEmoji(todayMood)} ${getEmotionText(todayMood)}` : 'ğŸ˜ æœªè®°å½•';
            
            renderDashboard();
        }
        
        function recordMood(dateStr) {
            showModal('è®°å½•æƒ…ç»ª', 'ğŸ˜Š', `
                <div class="form-group">
                    <label>é€‰æ‹©æƒ…ç»ª (${dateStr})</label>
                    <div class="emotion-selector">
                        <div class="emotion-btn" onclick="selectMoodForDate('good', '${dateStr}')">ğŸ˜Š å¼€å¿ƒ</div>
                        <div class="emotion-btn" onclick="selectMoodForDate('good', '${dateStr}')">ğŸ˜Œ å¹³é™</div>
                        <div class="emotion-btn" onclick="selectMoodForDate('neutral', '${dateStr}')">ğŸ˜ ä¸€èˆ¬</div>
                        <div class="emotion-btn" onclick="selectMoodForDate('bad', '${dateStr}')">ğŸ˜” éš¾è¿‡</div>
                        <div class="emotion-btn" onclick="selectMoodForDate('bad', '${dateStr}')">ğŸ˜« ç–²æƒ«</div>
                    </div>
                </div>
            `, `
                <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-save" onclick="saveMoodForDate('${dateStr}')">ä¿å­˜</button>
            `);
        }
        
        function selectMoodForDate(mood, dateStr) {
            selectedEmotion = mood;
            document.querySelectorAll('.emotion-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }
        
        function saveMoodForDate(dateStr) {
            if (!selectedEmotion) {
                alert('è¯·é€‰æ‹©æƒ…ç»ª');
                return;
            }
            
            appData.health.moodRecords[dateStr] = selectedEmotion;
            selectedEmotion = null;
            
            saveData();
            renderHealthModule();
            closeModal();
        }
        
        function prevMonth() {
            appData.health.currentMonth--;
            if (appData.health.currentMonth < 0) {
                appData.health.currentMonth = 11;
                appData.health.currentYear--;
            }
            renderHealthModule();
        }
        
        function nextMonth() {
            appData.health.currentMonth++;
            if (appData.health.currentMonth > 11) {
                appData.health.currentMonth = 0;
                appData.health.currentYear++;
            }
            renderHealthModule();
        }
        
        // ===== ç³»ç»Ÿè®¾ç½®å‡½æ•° =====
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `å°èŠ¸ç³»ç»Ÿå¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        appData = importedData;
                        saveData();
                        renderAll();
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } catch (err) {
                        alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function backupData() {
            appData.settings.lastBackup = new Date().toISOString();
            saveData();
            alert('æ•°æ®å¤‡ä»½å®Œæˆï¼');
        }
        
        function resetData() {
            showConfirmModal('ç¡®è®¤é‡ç½®', 'ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼', () => {
                initializeSystem();
            });
        }
        
        function setTheme(theme) {
            appData.settings.theme = theme;
            saveData();
            alert(`å·²åˆ‡æ¢åˆ°${theme === 'light' ? 'æµ…è‰²' : theme === 'dark' ? 'æ·±è‰²' : 'å¢¨ç»¿'}ä¸»é¢˜ï¼Œåˆ·æ–°é¡µé¢ç”Ÿæ•ˆ`);
        }
        
        // ===== é€šç”¨åŠŸèƒ½ =====
        function quickAction(action) {
            switch(action) {
                case 'journal':
                    switchTab('journal');
                    document.getElementById('journalContent').focus();
                    break;
                case 'finance':
                    switchTab('finance');
                    document.getElementById('transactionAmount').focus();
                    break;
                case 'timer':
                    startTimer();
                    switchTab('study');
                    break;
                case 'health':
                    switchTab('health');
                    break;
            }
        }
        
        // ===== è®¡æ—¶å™¨åŠŸèƒ½ =====
        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                timerInterval = setInterval(updateTimer, 1000);
            }
        }
        
        function pauseTimer() {
            if (isTimerRunning) {
                isTimerRunning = false;
                clearInterval(timerInterval);
            }
        }
        
        function stopTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            
            const note = document.getElementById('timerNote').value.trim();
            if (note) {
                const today = new Date().toISOString().split('T')[0];
                const duration = (25 * 60 - timerSeconds) / 60; // è½¬æ¢ä¸ºåˆ†é’Ÿ
                
                appData.study.studyRecords.push({
                    date: today,
                    duration,
                    note,
                    createdAt: new Date().toISOString()
                });
                
                saveData();
                renderStudyModule();
                alert(`è®¡æ—¶ç»“æŸï¼å­¦ä¹ å†…å®¹å·²è®°å½•ï¼š${note} (${duration.toFixed(1)}åˆ†é’Ÿ)`);
                document.getElementById('timerNote').value = '';
            } else {
                alert('è®¡æ—¶ç»“æŸï¼è¯·å¡«å†™å­¦ä¹ å†…å®¹å¤‡æ³¨ã€‚');
                document.getElementById('timerNote').focus();
            }
            
            timerSeconds = appData.study.timerSettings.defaultDuration * 60;
            updateTimerDisplay();
        }
        
        function updateTimer() {
            if (timerSeconds > 0) {
                timerSeconds--;
                updateTimerDisplay();
            } else {
                stopTimer();
            }
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // ===== æ—¥è®°åŠŸèƒ½ =====
        function insertTimestamp() {
            const textarea = document.getElementById('journalContent');
            const now = new Date();
            const timestamp = `ã€${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}ã€‘`;
            
            if (textarea.value.includes('//now')) {
                textarea.value = textarea.value.replace('//now', timestamp);
            } else {
                const cursorPos = textarea.selectionStart;
                const textBefore = textarea.value.substring(0, cursorPos);
                const textAfter = textarea.value.substring(cursorPos);
                textarea.value = textBefore + timestamp + ' ' + textAfter;
            }
        }
        
        function selectEmotion(button, emotion) {
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            selectedEmotion = emotion;
        }
        
        // ===== å·¥å…·å‡½æ•° =====
        function getEmotionText(emotion) {
            switch(emotion) {
                case 'good': return 'å¼€å¿ƒ';
                case 'neutral': return 'ä¸€èˆ¬';
                case 'bad': return 'éš¾è¿‡';
                default: return 'æœªçŸ¥';
            }
        }
        
        function getEmotionEmoji(emotion) {
            switch(emotion) {
                case 'good': return 'ğŸ˜Š';
                case 'neutral': return 'ğŸ˜';
                case 'bad': return 'ğŸ˜”';
                default: return 'â“';
            }
        }
        
        // ===== æ¨¡æ€æ¡†åŠŸèƒ½ =====
        function showModal(title, icon, bodyHTML, footerHTML) {
            document.getElementById('modalTitle').innerHTML = `<span>${icon}</span> ${title}`;
            document.getElementById('modalBody').innerHTML = bodyHTML;
            document.getElementById('modalFooter').innerHTML = footerHTML;
            document.getElementById('editModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
            currentEditItem = null;
            currentEditType = null;
        }
        
        function showConfirmModal(title, message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('active');
            
            const confirmBtn = document.getElementById('confirmActionBtn');
            confirmBtn.onclick = function() {
                closeConfirmModal();
                if (callback) callback();
            };
        }
        
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }
        
        // ===== é€‰é¡¹å¡åˆ‡æ¢ =====
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
        }
        
        // ===== åˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½æ•°æ®
            loadData();
            
            // åˆå§‹åŒ–æ¸²æŸ“
            renderAll();
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
            
            // åˆå§‹åŒ–è®¡æ—¶å™¨
            timerSeconds = appData.study.timerSettings.defaultDuration * 60;
            updateTimerDisplay();
            
            // é€‰é¡¹å¡ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // æ—¥è®° //now å¿«æ·é”®
            document.getElementById('journalContent').addEventListener('input', function(e) {
                if (this.value.includes('//now')) {
                    insertTimestamp();
                }
            });
            
            // å…¨å±€å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                // Ctrl+D: æ’å…¥å½“å‰æ—¶é—´
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    const activeElement = document.activeElement;
                    if (activeElement && (activeElement.id === 'journalContent' || activeElement.type === 'textarea')) {
                        insertTimestamp();
                    }
                }
                
                // Ctrl+Q: å¿«é€Ÿè®°è´¦
                if (e.ctrlKey && e.key === 'q') {
                    e.preventDefault();
                    quickAction('finance');
                }
                
                // Ctrl+T: å¼€å§‹è®¡æ—¶
                if (e.ctrlKey && e.key === 't') {
                    e.preventDefault();
                    quickAction('timer');
                }
            });
        });
    </script>
</body>
</html>